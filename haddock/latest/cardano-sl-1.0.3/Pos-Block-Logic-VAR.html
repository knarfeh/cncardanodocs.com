<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Pos.Block.Logic.VAR</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Pos-Block-Logic-VAR.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Pos.Block.Logic.VAR.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">cardano-sl-1.0.3: Cardano SL main implementation</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Pos.Block.Logic.VAR</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Exported for tests</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Verify|apply|rollback logic.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:verifyBlocksPrefix">verifyBlocksPrefix</a> :: <span class="keyword">forall</span> ssc ctx m. <a href="Pos-Block-Logic.html#t:MonadBlockVerify">MonadBlockVerify</a> ssc ctx m =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:OldestFirst">OldestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> (<a href="Pos-Block-Core.html#t:Block">Block</a> ssc) -&gt; m (<a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> VerifyBlocksException (<a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:OldestFirst">OldestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> <a href="Pos-Block-Types.html#t:Undo">Undo</a>, <a href="../cardano-sl-update-1.0.3/Pos-Update-Poll-Types.html#t:PollModifier">PollModifier</a>))</li><li class="src short"><span class="keyword">type</span> <a href="#t:BlockLrcMode">BlockLrcMode</a> ssc ctx m = (<a href="Pos-Block-Logic.html#t:MonadBlockApply">MonadBlockApply</a> ssc ctx m, <a href="Pos-Lrc.html#t:LrcModeFull">LrcModeFull</a> ssc ctx m)</li><li class="src short"><a href="#v:verifyAndApplyBlocks">verifyAndApplyBlocks</a> :: <span class="keyword">forall</span> ssc ctx m. (<a href="Pos-Block-Logic-VAR.html#t:BlockLrcMode">BlockLrcMode</a> ssc ctx m, <a href="Pos-Block-Logic.html#t:MonadMempoolNormalization">MonadMempoolNormalization</a> ssc ctx m) =&gt; <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:OldestFirst">OldestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> (<a href="Pos-Block-Core.html#t:Block">Block</a> ssc) -&gt; m (<a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> ApplyBlocksException <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:HeaderHash">HeaderHash</a>)</li><li class="src short"><a href="#v:applyWithRollback">applyWithRollback</a> :: (<a href="Pos-Block-Logic-VAR.html#t:BlockLrcMode">BlockLrcMode</a> ssc ctx m, <a href="Pos-Block-Logic.html#t:MonadMempoolNormalization">MonadMempoolNormalization</a> ssc ctx m) =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NewestFirst">NewestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> (<a href="Pos-Block-Types.html#t:Blund">Blund</a> ssc) -&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:OldestFirst">OldestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> (<a href="Pos-Block-Core.html#t:Block">Block</a> ssc) -&gt; m (<a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> ApplyBlocksException <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:HeaderHash">HeaderHash</a>)</li><li class="src short"><a href="#v:applyBlocks">applyBlocks</a> :: <span class="keyword">forall</span> ssc ctx m. <a href="Pos-Block-Logic-VAR.html#t:BlockLrcMode">BlockLrcMode</a> ssc ctx m =&gt; <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../cardano-sl-update-1.0.3/Pos-Update-Poll-Types.html#t:PollModifier">PollModifier</a> -&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:OldestFirst">OldestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> (<a href="Pos-Block-Types.html#t:Blund">Blund</a> ssc) -&gt; m ()</li><li class="src short"><a href="#v:rollbackBlocks">rollbackBlocks</a> :: <a href="Pos-Block-Logic-VAR.html#t:BlockLrcMode">BlockLrcMode</a> ssc ctx m =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NewestFirst">NewestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> (<a href="Pos-Block-Types.html#t:Blund">Blund</a> ssc) -&gt; m ()</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:verifyBlocksPrefix" class="def">verifyBlocksPrefix</a> :: <span class="keyword">forall</span> ssc ctx m. <a href="Pos-Block-Logic.html#t:MonadBlockVerify">MonadBlockVerify</a> ssc ctx m =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:OldestFirst">OldestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> (<a href="Pos-Block-Core.html#t:Block">Block</a> ssc) -&gt; m (<a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> VerifyBlocksException (<a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:OldestFirst">OldestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> <a href="Pos-Block-Types.html#t:Undo">Undo</a>, <a href="../cardano-sl-update-1.0.3/Pos-Update-Poll-Types.html#t:PollModifier">PollModifier</a>)) <a href="src/Pos.Block.Logic.VAR.html#verifyBlocksPrefix" class="link">Source</a> <a href="#v:verifyBlocksPrefix" class="selflink">#</a></p><div class="doc"><p>Verify new blocks. If parent of the first block is not our tip,
 verification fails. All blocks must be from the same epoch.  This
 function checks literally <strong>everything</strong> from blocks, including
 header, body, extra data, etc.</p><p>LRC must be already performed for the epoch from which blocks are.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:BlockLrcMode" class="def">BlockLrcMode</a> ssc ctx m = (<a href="Pos-Block-Logic.html#t:MonadBlockApply">MonadBlockApply</a> ssc ctx m, <a href="Pos-Lrc.html#t:LrcModeFull">LrcModeFull</a> ssc ctx m) <a href="src/Pos.Block.Logic.VAR.html#BlockLrcMode" class="link">Source</a> <a href="#t:BlockLrcMode" class="selflink">#</a></p><div class="doc"><p>Union of constraints required by block processing and LRC.</p></div></div><div class="top"><p class="src"><a id="v:verifyAndApplyBlocks" class="def">verifyAndApplyBlocks</a> :: <span class="keyword">forall</span> ssc ctx m. (<a href="Pos-Block-Logic-VAR.html#t:BlockLrcMode">BlockLrcMode</a> ssc ctx m, <a href="Pos-Block-Logic.html#t:MonadMempoolNormalization">MonadMempoolNormalization</a> ssc ctx m) =&gt; <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:OldestFirst">OldestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> (<a href="Pos-Block-Core.html#t:Block">Block</a> ssc) -&gt; m (<a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> ApplyBlocksException <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:HeaderHash">HeaderHash</a>) <a href="src/Pos.Block.Logic.VAR.html#verifyAndApplyBlocks" class="link">Source</a> <a href="#v:verifyAndApplyBlocks" class="selflink">#</a></p><div class="doc"><p>Applies blocks if they're valid. Takes one boolean flag
 &quot;rollback&quot;. Returns header hash of last applied block (new tip) on
 success. Failure behaviour depends on &quot;rollback&quot; flag. If it's on,
 all blocks applied inside this function will be rollbacked, so it
 will do effectively nothing and return 'Left error'. If it's off,
 it will try to apply as much blocks as it's possible and return
 header hash of new tip. It's up to caller to log warning that
 partial application happened.</p></div></div><div class="top"><p class="src"><a id="v:applyWithRollback" class="def">applyWithRollback</a> <a href="src/Pos.Block.Logic.VAR.html#applyWithRollback" class="link">Source</a> <a href="#v:applyWithRollback" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="Pos-Block-Logic-VAR.html#t:BlockLrcMode">BlockLrcMode</a> ssc ctx m, <a href="Pos-Block-Logic.html#t:MonadMempoolNormalization">MonadMempoolNormalization</a> ssc ctx m)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NewestFirst">NewestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> (<a href="Pos-Block-Types.html#t:Blund">Blund</a> ssc)</td><td class="doc"><p>Blocks to rollbck</p></td></tr><tr><td class="src">-&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:OldestFirst">OldestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> (<a href="Pos-Block-Core.html#t:Block">Block</a> ssc)</td><td class="doc"><p>Blocks to apply</p></td></tr><tr><td class="src">-&gt; m (<a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> ApplyBlocksException <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:HeaderHash">HeaderHash</a>)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Rollbacks some blocks and then applies some blocks.</p></div></div><h1 id="g:1">Exported for tests</h1><div class="top"><p class="src"><a id="v:applyBlocks" class="def">applyBlocks</a> :: <span class="keyword">forall</span> ssc ctx m. <a href="Pos-Block-Logic-VAR.html#t:BlockLrcMode">BlockLrcMode</a> ssc ctx m =&gt; <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../cardano-sl-update-1.0.3/Pos-Update-Poll-Types.html#t:PollModifier">PollModifier</a> -&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:OldestFirst">OldestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> (<a href="Pos-Block-Types.html#t:Blund">Blund</a> ssc) -&gt; m () <a href="src/Pos.Block.Logic.VAR.html#applyBlocks" class="link">Source</a> <a href="#v:applyBlocks" class="selflink">#</a></p><div class="doc"><p>Apply definitely valid sequence of blocks. At this point we must
 have verified all predicates regarding block (including txs and ssc
 data checks). We also must have taken lock on block application
 and ensured that chain is based on our tip. Blocks will be applied
 per-epoch, calculating lrc when needed if flag is set.</p></div></div><div class="top"><p class="src"><a id="v:rollbackBlocks" class="def">rollbackBlocks</a> :: <a href="Pos-Block-Logic-VAR.html#t:BlockLrcMode">BlockLrcMode</a> ssc ctx m =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NewestFirst">NewestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> (<a href="Pos-Block-Types.html#t:Blund">Blund</a> ssc) -&gt; m () <a href="src/Pos.Block.Logic.VAR.html#rollbackBlocks" class="link">Source</a> <a href="#v:rollbackBlocks" class="selflink">#</a></p><div class="doc"><p>Rollbacks blocks. Head must be the current tip.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.3</p></div></body></html>