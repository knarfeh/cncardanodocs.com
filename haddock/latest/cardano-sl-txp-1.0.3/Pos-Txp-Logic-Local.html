<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Pos.Txp.Logic.Local</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Pos-Txp-Logic-Local.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Pos.Txp.Logic.Local.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">cardano-sl-txp-1.0.3: Cardano SL - transaction processing</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Pos.Txp.Logic.Local</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Logic for local processing of transactions.
 Local transaction is transaction which hasn't been added in the blockchain yet.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:txProcessTransaction">txProcessTransaction</a> :: (TxpLocalWorkMode ctx m, <a href="../cardano-sl-core-1.0.3/Pos-Util-Util.html#t:HasLens-39-">HasLens'</a> ctx <a href="../cardano-sl-infra-1.0.3/Pos-StateLock.html#t:StateLock">StateLock</a>, <a href="../cardano-sl-core-1.0.3/Pos-Util-Util.html#t:HasLens-39-">HasLens'</a> ctx <a href="../cardano-sl-infra-1.0.3/Pos-StateLock.html#t:StateLockMetrics">StateLockMetrics</a>, MonadMask m) =&gt; (<a href="Pos-Txp-Core-Types.html#t:TxId">TxId</a>, <a href="Pos-Txp-Core-Types.html#t:TxAux">TxAux</a>) -&gt; m (<a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> <a href="Pos-Txp-Toil-Failure.html#t:ToilVerFailure">ToilVerFailure</a> ())</li><li class="src short"><a href="#v:txProcessTransactionNoLock">txProcessTransactionNoLock</a> :: TxpLocalWorkMode ctx m =&gt; (<a href="Pos-Txp-Core-Types.html#t:TxId">TxId</a>, <a href="Pos-Txp-Core-Types.html#t:TxAux">TxAux</a>) -&gt; m (<a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> <a href="Pos-Txp-Toil-Failure.html#t:ToilVerFailure">ToilVerFailure</a> ())</li><li class="src short"><a href="#v:txNormalize">txNormalize</a> :: (TxpLocalWorkMode ctx m, <a href="../cardano-sl-infra-1.0.3/Pos-Slotting-Class.html#t:MonadSlots">MonadSlots</a> ctx m) =&gt; m ()</li><li class="src short"><a href="#v:txGetPayload">txGetPayload</a> :: (<a href="../base-4.9.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m, <a href="Pos-Txp-MemState-Class.html#t:MonadTxpMem">MonadTxpMem</a> ext ctx m, WithLogger m) =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:HeaderHash">HeaderHash</a> -&gt; m [<a href="Pos-Txp-Core-Types.html#t:TxAux">TxAux</a>]</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:txProcessTransaction" class="def">txProcessTransaction</a> :: (TxpLocalWorkMode ctx m, <a href="../cardano-sl-core-1.0.3/Pos-Util-Util.html#t:HasLens-39-">HasLens'</a> ctx <a href="../cardano-sl-infra-1.0.3/Pos-StateLock.html#t:StateLock">StateLock</a>, <a href="../cardano-sl-core-1.0.3/Pos-Util-Util.html#t:HasLens-39-">HasLens'</a> ctx <a href="../cardano-sl-infra-1.0.3/Pos-StateLock.html#t:StateLockMetrics">StateLockMetrics</a>, MonadMask m) =&gt; (<a href="Pos-Txp-Core-Types.html#t:TxId">TxId</a>, <a href="Pos-Txp-Core-Types.html#t:TxAux">TxAux</a>) -&gt; m (<a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> <a href="Pos-Txp-Toil-Failure.html#t:ToilVerFailure">ToilVerFailure</a> ()) <a href="src/Pos.Txp.Logic.Local.html#txProcessTransaction" class="link">Source</a> <a href="#v:txProcessTransaction" class="selflink">#</a></p><div class="doc"><p>Process transaction. <code><a href="Pos-Txp-Core-Types.html#t:TxId">TxId</a></code> is expected to be the hash of
 transaction in <code><a href="Pos-Txp-Core-Types.html#t:TxAux">TxAux</a></code>. Separation is supported for optimization
 only.</p></div></div><div class="top"><p class="src"><a id="v:txProcessTransactionNoLock" class="def">txProcessTransactionNoLock</a> :: TxpLocalWorkMode ctx m =&gt; (<a href="Pos-Txp-Core-Types.html#t:TxId">TxId</a>, <a href="Pos-Txp-Core-Types.html#t:TxAux">TxAux</a>) -&gt; m (<a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> <a href="Pos-Txp-Toil-Failure.html#t:ToilVerFailure">ToilVerFailure</a> ()) <a href="src/Pos.Txp.Logic.Local.html#txProcessTransactionNoLock" class="link">Source</a> <a href="#v:txProcessTransactionNoLock" class="selflink">#</a></p><div class="doc"><p>Unsafe version of <code><a href="Pos-Txp-Logic-Local.html#v:txProcessTransaction">txProcessTransaction</a></code> which doesn't take a
 lock. Can be used in tests.</p></div></div><div class="top"><p class="src"><a id="v:txNormalize" class="def">txNormalize</a> :: (TxpLocalWorkMode ctx m, <a href="../cardano-sl-infra-1.0.3/Pos-Slotting-Class.html#t:MonadSlots">MonadSlots</a> ctx m) =&gt; m () <a href="src/Pos.Txp.Logic.Local.html#txNormalize" class="link">Source</a> <a href="#v:txNormalize" class="selflink">#</a></p><div class="doc"><ol><li>Recompute UtxoView by current MemPool
 | 2. Remove invalid transactions from MemPool
 | 3. Set new tip to txp local data</li></ol></div></div><div class="top"><p class="src"><a id="v:txGetPayload" class="def">txGetPayload</a> :: (<a href="../base-4.9.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m, <a href="Pos-Txp-MemState-Class.html#t:MonadTxpMem">MonadTxpMem</a> ext ctx m, WithLogger m) =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:HeaderHash">HeaderHash</a> -&gt; m [<a href="Pos-Txp-Core-Types.html#t:TxAux">TxAux</a>] <a href="src/Pos.Txp.Logic.Local.html#txGetPayload" class="link">Source</a> <a href="#v:txGetPayload" class="selflink">#</a></p><div class="doc"><p>Get <code>TxPayload</code> from mempool to include into a new block which
 will be based on the given tip. In something goes wrong, empty
 payload is returned. That's because we would sooner create an empty
 block to maintain decent chain quality than skip block creation.</p><p>We need to explicitly check that tip matches, even though we do
 mempool normalization whenever we apply/rollback a block. That's
 because we can't make them both atomically, i. e. can't guarantee
 that either none or both of them will be done.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.3</p></div></body></html>