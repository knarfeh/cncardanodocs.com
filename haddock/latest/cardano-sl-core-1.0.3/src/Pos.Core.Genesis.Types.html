<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Types related to genesis core data.</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Core</span><span class="hs-operator">.</span><span class="hs-identifier">Genesis</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span>
</span><a name="line-4"></a><span>       </span><span class="hs-special">(</span><span> </span><a href="Pos.Core.Genesis.Types.html#BalanceDistribution"><span class="hs-identifier hs-type">BalanceDistribution</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisWStakeholders"><span class="hs-identifier hs-type">GenesisWStakeholders</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-7"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisDelegation"><span class="hs-identifier hs-type">GenesisDelegation</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-8"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisVssCertificatesMap"><span class="hs-identifier hs-type">GenesisVssCertificatesMap</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-9"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#noGenesisDelegation"><span class="hs-identifier hs-var">noGenesisDelegation</span></a><span>
</span><a name="line-10"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#mkGenesisDelegation"><span class="hs-identifier hs-var">mkGenesisDelegation</span></a><span>
</span><a name="line-11"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#bootDustThreshold"><span class="hs-identifier hs-var">bootDustThreshold</span></a><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span>         </span><span class="hs-comment">-- * GenesisSpec</span><span>
</span><a name="line-14"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#TestnetBalanceOptions"><span class="hs-identifier hs-type">TestnetBalanceOptions</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#FakeAvvmOptions"><span class="hs-identifier hs-type">FakeAvvmOptions</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-16"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#TestnetDistribution"><span class="hs-identifier hs-type">TestnetDistribution</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisInitializer"><span class="hs-identifier hs-type">GenesisInitializer</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisAvvmBalances"><span class="hs-identifier hs-type">GenesisAvvmBalances</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisNonAvvmBalances"><span class="hs-identifier hs-type">GenesisNonAvvmBalances</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#ProtocolConstants"><span class="hs-identifier hs-type">ProtocolConstants</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisSpec"><span class="hs-identifier hs-type">GenesisSpec</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#convertNonAvvmDataToBalances"><span class="hs-identifier hs-var">convertNonAvvmDataToBalances</span></a><span>
</span><a name="line-23"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#mkGenesisSpec"><span class="hs-identifier hs-var">mkGenesisSpec</span></a><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span>       </span><span class="hs-comment">-- * GenesisData</span><span>
</span><a name="line-26"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisData"><span class="hs-identifier hs-type">GenesisData</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Core.Genesis.Types.html#genesisDataFromSpec"><span class="hs-identifier hs-var">genesisDataFromSpec</span></a><span>
</span><a name="line-28"></a><span>       </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Universum</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Lens</span><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">at</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Except</span><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadError</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">throwError</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">HashMap</span><span class="hs-operator">.</span><span class="hs-identifier">Strict</span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">HM</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Buildable</span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Buildable</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Formatting</span><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">bprint</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">build</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sformat</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">%</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Serokell</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">allDistinct</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mapJson</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Binary.Class.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Binary</span><span class="hs-operator">.</span><span class="hs-identifier">Class</span></a><span>         </span><span class="hs-special">(</span><a href="Pos.Binary.Class.Core.html#Bi"><span class="hs-identifier hs-type">Bi</span></a><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Core.Address.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Core</span><span class="hs-operator">.</span><span class="hs-identifier">Address</span></a><span>         </span><span class="hs-special">(</span><a href="Pos.Core.Address.html#addressHash"><span class="hs-identifier hs-var">addressHash</span></a><span class="hs-special">,</span><span> </span><a href="Pos.Core.Address.html#decodeTextAddress"><span class="hs-identifier hs-var">decodeTextAddress</span></a><span class="hs-special">)</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Core.Coin.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Core</span><span class="hs-operator">.</span><span class="hs-identifier">Coin</span></a><span>            </span><span class="hs-special">(</span><a href="Pos.Core.Coin.html#unsafeAddCoin"><span class="hs-identifier hs-var">unsafeAddCoin</span></a><span class="hs-special">,</span><span> </span><a href="Pos.Core.Coin.html#unsafeIntegerToCoin"><span class="hs-identifier hs-var">unsafeIntegerToCoin</span></a><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Core.Types.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Core</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>           </span><span class="hs-special">(</span><a href="Pos.Core.Types.html#Address"><span class="hs-identifier hs-type">Address</span></a><span class="hs-special">,</span><span> </span><a href="Pos.Core.Types.html#BlockVersionData"><span class="hs-identifier hs-type">BlockVersionData</span></a><span class="hs-special">,</span><span> </span><a href="Pos.Core.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a><span class="hs-special">,</span><span> </span><a href="Pos.Core.Types.html#ProxySKHeavy"><span class="hs-identifier hs-type">ProxySKHeavy</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>                                           </span><a href="Pos.Core.Types.html#SharedSeed"><span class="hs-identifier hs-type">SharedSeed</span></a><span class="hs-special">,</span><span> </span><a href="Pos.Core.Types.html#StakeholderId"><span class="hs-identifier hs-type">StakeholderId</span></a><span class="hs-special">,</span><span> </span><a href="Pos.Core.Timestamp.html#Timestamp"><span class="hs-identifier hs-type">Timestamp</span></a><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Core.Vss.Types.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Core</span><span class="hs-operator">.</span><span class="hs-identifier">Vss</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>       </span><span class="hs-special">(</span><a href="Pos.Core.Vss.Types.html#VssCertificatesMap"><span class="hs-identifier hs-type">VssCertificatesMap</span></a><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Crypto.Signing.Types.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Signing</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span> </span><span class="hs-special">(</span><a href="Pos.Crypto.Signing.Types.Signing.html#ProxySecretKey"><span class="hs-identifier hs-type">ProxySecretKey</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Pos.Crypto.Signing.Types.Redeem.html#RedeemPublicKey"><span class="hs-identifier hs-type">RedeemPublicKey</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>                                           </span><a href="Pos.Crypto.Signing.Types.Signing.html#isSelfSignedPsk"><span class="hs-identifier hs-var">isSelfSignedPsk</span></a><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-comment">-- | Balances distribution in genesis block.</span><span>
</span><a name="line-49"></a><span class="hs-keyword">data</span><span> </span><a name="BalanceDistribution"><a href="Pos.Core.Genesis.Types.html#BalanceDistribution"><span class="hs-identifier">BalanceDistribution</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-50"></a><span>    </span><span class="hs-comment">-- | Rich/poor distribution, for testnet mostly.</span><span>
</span><a name="line-51"></a><span>    </span><a name="RichPoorBalances"><a href="Pos.Core.Genesis.Types.html#RichPoorBalances"><span class="hs-identifier">RichPoorBalances</span></a></a><span>
</span><a name="line-52"></a><span>        </span><span class="hs-special">{</span><span> </span><a name="sdRichmen"><a href="Pos.Core.Genesis.Types.html#sdRichmen"><span class="hs-identifier">sdRichmen</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Word</span><span>
</span><a name="line-53"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="sdRichBalance"><a href="Pos.Core.Genesis.Types.html#sdRichBalance"><span class="hs-identifier">sdRichBalance</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a><span>
</span><a name="line-54"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="sdPoor"><a href="Pos.Core.Genesis.Types.html#sdPoor"><span class="hs-identifier">sdPoor</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Word</span><span>
</span><a name="line-55"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="sdPoorBalance"><a href="Pos.Core.Genesis.Types.html#sdPoorBalance"><span class="hs-identifier">sdPoorBalance</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a><span>
</span><a name="line-56"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-57"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-comment">-- | Wrapper around weighted stakeholders map to be used in genesis</span><span>
</span><a name="line-60"></a><span class="hs-comment">-- core data.</span><span>
</span><a name="line-61"></a><span class="hs-keyword">newtype</span><span> </span><a name="GenesisWStakeholders"><a href="Pos.Core.Genesis.Types.html#GenesisWStakeholders"><span class="hs-identifier">GenesisWStakeholders</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="GenesisWStakeholders"><a href="Pos.Core.Genesis.Types.html#GenesisWStakeholders"><span class="hs-identifier">GenesisWStakeholders</span></a></a><span>
</span><a name="line-62"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="getGenesisWStakeholders"><a href="Pos.Core.Genesis.Types.html#getGenesisWStakeholders"><span class="hs-identifier">getGenesisWStakeholders</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="Pos.Core.Types.html#StakeholderId"><span class="hs-identifier hs-type">StakeholderId</span></a><span> </span><span class="hs-identifier hs-type">Word16</span><span>
</span><a name="line-63"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Buildable</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisWStakeholders"><span class="hs-identifier hs-type">GenesisWStakeholders</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-66"></a><span>    </span><a name="local-8214565720323802816"><span class="hs-identifier">build</span></a><span> </span><span class="hs-special">(</span><a href="Pos.Core.Genesis.Types.html#GenesisWStakeholders"><span class="hs-identifier hs-var">GenesisWStakeholders</span></a><span> </span><a name="local-6989586621680341193"><a href="#local-6989586621680341193"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-67"></a><span>        </span><span class="hs-identifier hs-var">bprint</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;GenesisWStakeholders: &quot;</span><span class="hs-operator hs-var">%</span><span class="hs-identifier hs-var">mapJson</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680341193"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-comment">-- | This type contains genesis state of heavyweight delegation. It</span><span>
</span><a name="line-70"></a><span class="hs-comment">-- wraps a map where keys are issuers (i. e. stakeholders who</span><span>
</span><a name="line-71"></a><span class="hs-comment">-- delegated) and values are proxy signing keys. There are some invariants:</span><span>
</span><a name="line-72"></a><span class="hs-comment">-- 1. In each pair delegate must differ from issuer, i. e. no revocations.</span><span>
</span><a name="line-73"></a><span class="hs-comment">-- 2. PSKs must be consistent with keys in the map, i. e. issuer's ID must be</span><span>
</span><a name="line-74"></a><span class="hs-comment">--    equal to the key in the map.</span><span>
</span><a name="line-75"></a><span class="hs-comment">-- 3. Delegates can't be issuers, i. e. transitive delegation is not supported.</span><span>
</span><a name="line-76"></a><span class="hs-comment">--    It's not needed in genesis, it can always be reduced.</span><span>
</span><a name="line-77"></a><span class="hs-keyword">newtype</span><span> </span><a name="GenesisDelegation"><a href="Pos.Core.Genesis.Types.html#GenesisDelegation"><span class="hs-identifier">GenesisDelegation</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="UnsafeGenesisDelegation"><a href="Pos.Core.Genesis.Types.html#UnsafeGenesisDelegation"><span class="hs-identifier">UnsafeGenesisDelegation</span></a></a><span>
</span><a name="line-78"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="unGenesisDelegation"><a href="Pos.Core.Genesis.Types.html#unGenesisDelegation"><span class="hs-identifier">unGenesisDelegation</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HashMap</span><span> </span><a href="Pos.Core.Types.html#StakeholderId"><span class="hs-identifier hs-type">StakeholderId</span></a><span> </span><a href="Pos.Core.Types.html#ProxySKHeavy"><span class="hs-identifier hs-type">ProxySKHeavy</span></a><span>
</span><a name="line-79"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-comment">-- | Empty 'GenesisDelegation'.</span><span>
</span><a name="line-82"></a><span class="hs-identifier">noGenesisDelegation</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisDelegation"><span class="hs-identifier hs-type">GenesisDelegation</span></a><span>
</span><a name="line-83"></a><a name="noGenesisDelegation"><a href="Pos.Core.Genesis.Types.html#noGenesisDelegation"><span class="hs-identifier">noGenesisDelegation</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Core.Genesis.Types.html#UnsafeGenesisDelegation"><span class="hs-identifier hs-var">UnsafeGenesisDelegation</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span class="hs-comment">-- | Safe constructor of 'GenesisDelegation'.</span><span>
</span><a name="line-86"></a><span class="hs-identifier">mkGenesisDelegation</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-87"></a><span>       </span><span class="hs-identifier hs-type">MonadError</span><span> </span><span class="hs-identifier hs-type">Text</span><span> </span><a href="#local-6989586621680341087"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-88"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">HashMap</span><span> </span><a href="Pos.Core.Types.html#StakeholderId"><span class="hs-identifier hs-type">StakeholderId</span></a><span> </span><a href="Pos.Core.Types.html#ProxySKHeavy"><span class="hs-identifier hs-type">ProxySKHeavy</span></a><span>
</span><a name="line-89"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680341087"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisDelegation"><span class="hs-identifier hs-type">GenesisDelegation</span></a><span>
</span><a name="line-90"></a><a name="mkGenesisDelegation"><a href="Pos.Core.Genesis.Types.html#mkGenesisDelegation"><span class="hs-identifier">mkGenesisDelegation</span></a></a><span> </span><a name="local-6989586621680341088"><a href="#local-6989586621680341088"><span class="hs-identifier">pskM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-91"></a><span>    </span><span class="hs-identifier hs-var">forM_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621680341088"><span class="hs-identifier hs-var">pskM</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621680341090"><a href="#local-6989586621680341090"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><span> </span><a href="Pos.Crypto.Signing.Types.Signing.html#ProxySecretKey"><span class="hs-identifier hs-var">ProxySecretKey</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-92"></a><span>        </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="Pos.Core.Address.html#addressHash"><span class="hs-identifier hs-var">addressHash</span></a><span> </span><a href="#local-6989586621680341092"><span class="hs-identifier hs-var">pskIssuerPk</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621680341090"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-93"></a><span>            </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">sformat</span><span>
</span><a name="line-94"></a><span>                </span><span class="hs-special">(</span><span class="hs-string">&quot;wrong issuerPk set as key for delegation map: &quot;</span><span class="hs-operator hs-var">%</span><span>
</span><a name="line-95"></a><span>                 </span><span class="hs-string">&quot;issuer id = &quot;</span><span class="hs-operator hs-var">%</span><span class="hs-identifier hs-var">build</span><span class="hs-operator hs-var">%</span><span class="hs-string">&quot;, cert id = &quot;</span><span class="hs-operator hs-var">%</span><span class="hs-identifier hs-var">build</span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span>                </span><a href="#local-6989586621680341090"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><a href="Pos.Core.Address.html#addressHash"><span class="hs-identifier hs-var">addressHash</span></a><span> </span><a href="#local-6989586621680341092"><span class="hs-identifier hs-var">pskIssuerPk</span></a><span class="hs-special">)</span><span>
</span><a name="line-97"></a><span>    </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">allDistinct</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">pskIssuerPk</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621680341089"><span class="hs-identifier hs-var">psks</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-98"></a><span>        </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-string">&quot;all issuers must be distinct&quot;</span><span>
</span><a name="line-99"></a><span>    </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">any</span><span> </span><a href="Pos.Crypto.Signing.Types.Signing.html#isSelfSignedPsk"><span class="hs-identifier hs-var">isSelfSignedPsk</span></a><span> </span><a href="#local-6989586621680341089"><span class="hs-identifier hs-var">psks</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-100"></a><span>        </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-string">&quot;there is a self-signed (revocation) psk&quot;</span><span>
</span><a name="line-101"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680341147"><a href="#local-6989586621680341147"><span class="hs-identifier">resPairs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-102"></a><span>            </span><a href="#local-6989586621680341089"><span class="hs-identifier hs-var">psks</span></a><span> </span><span class="hs-operator hs-var">&lt;&amp;&gt;</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680341148"><a href="#local-6989586621680341148"><span class="hs-identifier">psk</span></a></a><span class="hs-glyph">@</span><a href="Pos.Crypto.Signing.Types.Signing.html#ProxySecretKey"><span class="hs-identifier hs-var">ProxySecretKey</span></a><span> </span><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Pos.Core.Address.html#addressHash"><span class="hs-identifier hs-var">addressHash</span></a><span> </span><a href="#local-6989586621680341150"><span class="hs-identifier hs-var">pskIssuerPk</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680341148"><span class="hs-identifier hs-var">psk</span></a><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680341153"><a href="#local-6989586621680341153"><span class="hs-identifier">resMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">HM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><a href="#local-6989586621680341147"><span class="hs-identifier hs-var">resPairs</span></a><span>
</span><a name="line-104"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680341154"><a href="#local-6989586621680341154"><span class="hs-identifier">isIssuer</span></a></a><span> </span><a href="Pos.Crypto.Signing.Types.Signing.html#ProxySecretKey"><span class="hs-identifier hs-var">ProxySecretKey</span></a><span> </span><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-105"></a><span>            </span><span class="hs-identifier hs-var">isJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621680341153"><span class="hs-identifier hs-var">resMap</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><span class="hs-identifier hs-var">at</span><span> </span><span class="hs-special">(</span><a href="Pos.Core.Address.html#addressHash"><span class="hs-identifier hs-var">addressHash</span></a><span> </span><a href="#local-6989586621680341157"><span class="hs-identifier hs-var">pskDelegatePk</span></a><span class="hs-special">)</span><span>
</span><a name="line-106"></a><span>    </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">any</span><span> </span><a href="#local-6989586621680341154"><span class="hs-identifier hs-var">isIssuer</span></a><span> </span><a href="#local-6989586621680341089"><span class="hs-identifier hs-var">psks</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-107"></a><span>        </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-string">&quot;one of the delegates is also an issuer, don't do it&quot;</span><span>
</span><a name="line-108"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Pos.Core.Genesis.Types.html#UnsafeGenesisDelegation"><span class="hs-identifier hs-var">UnsafeGenesisDelegation</span></a><span> </span><a href="#local-6989586621680341153"><span class="hs-identifier hs-var">resMap</span></a><span>
</span><a name="line-109"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-110"></a><span>    </span><a name="local-6989586621680341089"><a href="#local-6989586621680341089"><span class="hs-identifier">psks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621680341088"><span class="hs-identifier hs-var">pskM</span></a><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span class="hs-comment">-- | Calculates a minimum amount of coins user can set as an output in</span><span>
</span><a name="line-113"></a><span class="hs-comment">-- boot era.</span><span>
</span><a name="line-114"></a><span class="hs-identifier">bootDustThreshold</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisWStakeholders"><span class="hs-identifier hs-type">GenesisWStakeholders</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pos.Core.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a><span>
</span><a name="line-115"></a><a name="bootDustThreshold"><a href="Pos.Core.Genesis.Types.html#bootDustThreshold"><span class="hs-identifier">bootDustThreshold</span></a></a><span> </span><span class="hs-special">(</span><a href="Pos.Core.Genesis.Types.html#GenesisWStakeholders"><span class="hs-identifier hs-var">GenesisWStakeholders</span></a><span> </span><a name="local-6989586621680341159"><a href="#local-6989586621680341159"><span class="hs-identifier">bootHolders</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-116"></a><span>    </span><span class="hs-comment">-- it's safe to use it here because weights are word16 and should</span><span>
</span><a name="line-117"></a><span>    </span><span class="hs-comment">-- be really low in production, so this sum is not going to be</span><span>
</span><a name="line-118"></a><span>    </span><span class="hs-comment">-- even more than 10-15 coins.</span><span>
</span><a name="line-119"></a><span>    </span><a href="Pos.Core.Coin.html#unsafeIntegerToCoin"><span class="hs-identifier hs-var">unsafeIntegerToCoin</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621680341159"><span class="hs-identifier hs-var">bootHolders</span></a><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-122"></a><span class="hs-comment">-- Genesis Spec</span><span>
</span><a name="line-123"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span class="hs-comment">-- | These options determine balances of nodes specific for testnet.</span><span>
</span><a name="line-126"></a><span class="hs-keyword">data</span><span> </span><a name="TestnetBalanceOptions"><a href="Pos.Core.Genesis.Types.html#TestnetBalanceOptions"><span class="hs-identifier">TestnetBalanceOptions</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TestnetBalanceOptions"><a href="Pos.Core.Genesis.Types.html#TestnetBalanceOptions"><span class="hs-identifier">TestnetBalanceOptions</span></a></a><span>
</span><a name="line-127"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="tboPoors"><a href="Pos.Core.Genesis.Types.html#tboPoors"><span class="hs-identifier">tboPoors</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Word</span><span>
</span><a name="line-128"></a><span>    </span><span class="hs-comment">-- ^ Number of poor nodes (with small balance).</span><span>
</span><a name="line-129"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="tboRichmen"><a href="Pos.Core.Genesis.Types.html#tboRichmen"><span class="hs-identifier">tboRichmen</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Word</span><span>
</span><a name="line-130"></a><span>    </span><span class="hs-comment">-- ^ Number of rich nodes (with huge balance).</span><span>
</span><a name="line-131"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="tboTotalBalance"><a href="Pos.Core.Genesis.Types.html#tboTotalBalance"><span class="hs-identifier">tboTotalBalance</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-132"></a><span>    </span><span class="hs-comment">-- ^ Total balance owned by these nodes.</span><span>
</span><a name="line-133"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="tboRichmenShare"><a href="Pos.Core.Genesis.Types.html#tboRichmenShare"><span class="hs-identifier">tboRichmenShare</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Double</span><span>
</span><a name="line-134"></a><span>    </span><span class="hs-comment">-- ^ Portion of stake owned by all richmen together.</span><span>
</span><a name="line-135"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="tboUseHDAddresses"><a href="Pos.Core.Genesis.Types.html#tboUseHDAddresses"><span class="hs-identifier">tboUseHDAddresses</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-136"></a><span>    </span><span class="hs-comment">-- ^ Whether generate plain addresses or with hd payload.</span><span>
</span><a name="line-137"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span class="hs-comment">-- | These options determines balances of fake AVVM nodes which didn't</span><span>
</span><a name="line-140"></a><span class="hs-comment">-- really go through vending, but pretend they did.</span><span>
</span><a name="line-141"></a><span class="hs-keyword">data</span><span> </span><a name="FakeAvvmOptions"><a href="Pos.Core.Genesis.Types.html#FakeAvvmOptions"><span class="hs-identifier">FakeAvvmOptions</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="FakeAvvmOptions"><a href="Pos.Core.Genesis.Types.html#FakeAvvmOptions"><span class="hs-identifier">FakeAvvmOptions</span></a></a><span>
</span><a name="line-142"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="faoCount"><a href="Pos.Core.Genesis.Types.html#faoCount"><span class="hs-identifier">faoCount</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Word</span><span>
</span><a name="line-143"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="faoOneBalance"><a href="Pos.Core.Genesis.Types.html#faoOneBalance"><span class="hs-identifier">faoOneBalance</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-144"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-comment">-- | This data type determines how to generate bootstrap stakeholders</span><span>
</span><a name="line-147"></a><span class="hs-comment">-- in testnet.</span><span>
</span><a name="line-148"></a><span class="hs-keyword">data</span><span> </span><a name="TestnetDistribution"><a href="Pos.Core.Genesis.Types.html#TestnetDistribution"><span class="hs-identifier">TestnetDistribution</span></a></a><span>
</span><a name="line-149"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="TestnetRichmenStakeDistr"><a href="Pos.Core.Genesis.Types.html#TestnetRichmenStakeDistr"><span class="hs-identifier">TestnetRichmenStakeDistr</span></a></a><span>
</span><a name="line-150"></a><span>    </span><span class="hs-comment">-- ^ Rich nodes will be bootstrap stakeholders with equal weights.</span><span>
</span><a name="line-151"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="TestnetCustomStakeDistr"><a href="Pos.Core.Genesis.Types.html#TestnetCustomStakeDistr"><span class="hs-identifier">TestnetCustomStakeDistr</span></a></a><span>
</span><a name="line-152"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="tcsdBootStakeholders"><a href="Pos.Core.Genesis.Types.html#tcsdBootStakeholders"><span class="hs-identifier">tcsdBootStakeholders</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#GenesisWStakeholders"><span class="hs-identifier hs-type">GenesisWStakeholders</span></a><span>
</span><a name="line-153"></a><span>    </span><span class="hs-comment">-- ^ Bootstrap stakeholders and their weights are provided explicitly.</span><span>
</span><a name="line-154"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="tcsdVssCerts"><a href="Pos.Core.Genesis.Types.html#tcsdVssCerts"><span class="hs-identifier">tcsdVssCerts</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#GenesisVssCertificatesMap"><span class="hs-identifier hs-type">GenesisVssCertificatesMap</span></a><span>
</span><a name="line-155"></a><span>    </span><span class="hs-comment">-- ^ Vss certificates are provided explicitly too, because they</span><span>
</span><a name="line-156"></a><span>    </span><span class="hs-comment">-- can't be generated automatically in this case.</span><span>
</span><a name="line-157"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span class="hs-comment">-- | This data type contains various options presense of which depends</span><span>
</span><a name="line-160"></a><span class="hs-comment">-- on whether we want genesis for mainnet or testnet.</span><span>
</span><a name="line-161"></a><span class="hs-keyword">data</span><span> </span><a name="GenesisInitializer"><a href="Pos.Core.Genesis.Types.html#GenesisInitializer"><span class="hs-identifier">GenesisInitializer</span></a></a><span>
</span><a name="line-162"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="TestnetInitializer"><a href="Pos.Core.Genesis.Types.html#TestnetInitializer"><span class="hs-identifier">TestnetInitializer</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-163"></a><span>      </span><a name="tiTestBalance"><a href="Pos.Core.Genesis.Types.html#tiTestBalance"><span class="hs-identifier">tiTestBalance</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#TestnetBalanceOptions"><span class="hs-identifier hs-type">TestnetBalanceOptions</span></a><span>
</span><a name="line-164"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="tiFakeAvvmBalance"><a href="Pos.Core.Genesis.Types.html#tiFakeAvvmBalance"><span class="hs-identifier">tiFakeAvvmBalance</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#FakeAvvmOptions"><span class="hs-identifier hs-type">FakeAvvmOptions</span></a><span>
</span><a name="line-165"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="tiDistribution"><a href="Pos.Core.Genesis.Types.html#tiDistribution"><span class="hs-identifier">tiDistribution</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#TestnetDistribution"><span class="hs-identifier hs-type">TestnetDistribution</span></a><span>
</span><a name="line-166"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="tiSeed"><a href="Pos.Core.Genesis.Types.html#tiSeed"><span class="hs-identifier">tiSeed</span></a></a><span>            </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-167"></a><span>      </span><span class="hs-comment">-- ^ Seed to use to generate secret data. It's used only in</span><span>
</span><a name="line-168"></a><span>      </span><span class="hs-comment">-- testnet, shouldn't be used for anything important.</span><span>
</span><a name="line-169"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-170"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="MainnetInitializer"><a href="Pos.Core.Genesis.Types.html#MainnetInitializer"><span class="hs-identifier">MainnetInitializer</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-171"></a><span>      </span><a name="miStartTime"><a href="Pos.Core.Genesis.Types.html#miStartTime"><span class="hs-identifier">miStartTime</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Timestamp.html#Timestamp"><span class="hs-identifier hs-type">Timestamp</span></a><span>
</span><a name="line-172"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="miBootStakeholders"><a href="Pos.Core.Genesis.Types.html#miBootStakeholders"><span class="hs-identifier">miBootStakeholders</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#GenesisWStakeholders"><span class="hs-identifier hs-type">GenesisWStakeholders</span></a><span>
</span><a name="line-173"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="miVssCerts"><a href="Pos.Core.Genesis.Types.html#miVssCerts"><span class="hs-identifier">miVssCerts</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#GenesisVssCertificatesMap"><span class="hs-identifier hs-type">GenesisVssCertificatesMap</span></a><span>
</span><a name="line-174"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="miNonAvvmBalances"><a href="Pos.Core.Genesis.Types.html#miNonAvvmBalances"><span class="hs-identifier">miNonAvvmBalances</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#GenesisNonAvvmBalances"><span class="hs-identifier hs-type">GenesisNonAvvmBalances</span></a><span>
</span><a name="line-175"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-comment">-- | Predefined balances of avvm entries.</span><span>
</span><a name="line-178"></a><span class="hs-keyword">newtype</span><span> </span><a name="GenesisAvvmBalances"><a href="Pos.Core.Genesis.Types.html#GenesisAvvmBalances"><span class="hs-identifier">GenesisAvvmBalances</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="GenesisAvvmBalances"><a href="Pos.Core.Genesis.Types.html#GenesisAvvmBalances"><span class="hs-identifier">GenesisAvvmBalances</span></a></a><span>
</span><a name="line-179"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="getGenesisAvvmBalances"><a href="Pos.Core.Genesis.Types.html#getGenesisAvvmBalances"><span class="hs-identifier">getGenesisAvvmBalances</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HashMap</span><span> </span><a href="Pos.Crypto.Signing.Types.Redeem.html#RedeemPublicKey"><span class="hs-identifier hs-type">RedeemPublicKey</span></a><span> </span><a href="Pos.Core.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a><span>
</span><a name="line-180"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>
</span><a name="line-182"></a><span class="hs-comment">-- | Predefined balances of non avvm entries.</span><span>
</span><a name="line-183"></a><span class="hs-keyword">newtype</span><span> </span><a name="GenesisVssCertificatesMap"><a href="Pos.Core.Genesis.Types.html#GenesisVssCertificatesMap"><span class="hs-identifier">GenesisVssCertificatesMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="GenesisVssCertificatesMap"><a href="Pos.Core.Genesis.Types.html#GenesisVssCertificatesMap"><span class="hs-identifier">GenesisVssCertificatesMap</span></a></a><span>
</span><a name="line-184"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="getGenesisVssCertificatesMap"><a href="Pos.Core.Genesis.Types.html#getGenesisVssCertificatesMap"><span class="hs-identifier">getGenesisVssCertificatesMap</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pos.Core.Vss.Types.html#VssCertificatesMap"><span class="hs-identifier hs-type">VssCertificatesMap</span></a><span>
</span><a name="line-185"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span class="hs-special">)</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-comment">-- | Predefined balances of non avvm entries.</span><span>
</span><a name="line-188"></a><span class="hs-keyword">newtype</span><span> </span><a name="GenesisNonAvvmBalances"><a href="Pos.Core.Genesis.Types.html#GenesisNonAvvmBalances"><span class="hs-identifier">GenesisNonAvvmBalances</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="GenesisNonAvvmBalances"><a href="Pos.Core.Genesis.Types.html#GenesisNonAvvmBalances"><span class="hs-identifier">GenesisNonAvvmBalances</span></a></a><span>
</span><a name="line-189"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="getGenesisNonAvvmBalances"><a href="Pos.Core.Genesis.Types.html#getGenesisNonAvvmBalances"><span class="hs-identifier">getGenesisNonAvvmBalances</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HashMap</span><span> </span><a href="Pos.Core.Types.html#Address"><span class="hs-identifier hs-type">Address</span></a><span> </span><a href="Pos.Core.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a><span>
</span><a name="line-190"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">)</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><a href="Pos.Binary.Class.Core.html#Bi"><span class="hs-identifier hs-type">Bi</span></a><span> </span><a href="Pos.Core.Types.html#Address"><span class="hs-identifier hs-type">Address</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisNonAvvmBalances"><span class="hs-identifier hs-type">GenesisNonAvvmBalances</span></a><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span class="hs-comment">-- | Generate genesis address distribution out of avvm</span><span>
</span><a name="line-195"></a><span class="hs-comment">-- parameters. Txdistr of the utxo is all empty. Redelegate it in</span><span>
</span><a name="line-196"></a><span class="hs-comment">-- calling funciton.</span><span>
</span><a name="line-197"></a><span class="hs-identifier">convertNonAvvmDataToBalances</span><span>
</span><a name="line-198"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621680341086"><a href="#local-6989586621680341086"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-operator">.</span><span>
</span><a name="line-199"></a><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">MonadFail</span><span> </span><a href="#local-6989586621680341086"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Pos.Binary.Class.Core.html#Bi"><span class="hs-identifier hs-type">Bi</span></a><span> </span><a href="Pos.Core.Types.html#Address"><span class="hs-identifier hs-type">Address</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-200"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">HashMap</span><span> </span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-201"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680341086"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisNonAvvmBalances"><span class="hs-identifier hs-type">GenesisNonAvvmBalances</span></a><span>
</span><a name="line-202"></a><a name="convertNonAvvmDataToBalances"><a href="Pos.Core.Genesis.Types.html#convertNonAvvmDataToBalances"><span class="hs-identifier">convertNonAvvmDataToBalances</span></a></a><span> </span><a name="local-6989586621680341160"><a href="#local-6989586621680341160"><span class="hs-identifier">balances</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisNonAvvmBalances"><span class="hs-identifier hs-var">GenesisNonAvvmBalances</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621680341161"><span class="hs-identifier hs-var">balances'</span></a><span>
</span><a name="line-203"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-204"></a><span>    </span><span class="hs-identifier">balances'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621680341086"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HashMap</span><span> </span><a href="Pos.Core.Types.html#Address"><span class="hs-identifier hs-type">Address</span></a><span> </span><a href="Pos.Core.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span>    </span><a name="local-6989586621680341161"><a href="#local-6989586621680341161"><span class="hs-identifier">balances'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">HM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromListWith</span><span> </span><a href="Pos.Core.Coin.html#unsafeAddCoin"><span class="hs-identifier hs-var">unsafeAddCoin</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><a href="#local-6989586621680341162"><span class="hs-identifier hs-var">convert</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621680341160"><span class="hs-identifier hs-var">balances</span></a><span class="hs-special">)</span><span>
</span><a name="line-206"></a><span>    </span><span class="hs-identifier">convert</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680341086"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Pos.Core.Types.html#Address"><span class="hs-identifier hs-type">Address</span></a><span class="hs-special">,</span><span> </span><a href="Pos.Core.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a><span class="hs-special">)</span><span>
</span><a name="line-207"></a><span>    </span><a name="local-6989586621680341162"><a href="#local-6989586621680341162"><span class="hs-identifier">convert</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680341163"><a href="#local-6989586621680341163"><span class="hs-identifier">txt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680341164"><a href="#local-6989586621680341164"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Pos.Core.Address.html#decodeTextAddress"><span class="hs-identifier hs-var">decodeTextAddress</span></a><span> </span><a href="#local-6989586621680341163"><span class="hs-identifier hs-var">txt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-208"></a><span>        </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621680341165"><a href="#local-6989586621680341165"><span class="hs-identifier">err</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toString</span><span> </span><a href="#local-6989586621680341165"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span>
</span><a name="line-209"></a><span>        </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621680341166"><a href="#local-6989586621680341166"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680341166"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">,</span><span> </span><a href="Pos.Core.Coin.html#unsafeIntegerToCoin"><span class="hs-identifier hs-var">unsafeIntegerToCoin</span></a><span> </span><a href="#local-6989586621680341164"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span class="hs-comment">-- | 'ProtocolConstants' are not really part of genesis global state,</span><span>
</span><a name="line-212"></a><span class="hs-comment">-- but they affect consensus, so they are part of 'GenesisSpec' and</span><span>
</span><a name="line-213"></a><span class="hs-comment">-- 'GenesisData'.</span><span>
</span><a name="line-214"></a><span class="hs-keyword">data</span><span> </span><a name="ProtocolConstants"><a href="Pos.Core.Genesis.Types.html#ProtocolConstants"><span class="hs-identifier">ProtocolConstants</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ProtocolConstants"><a href="Pos.Core.Genesis.Types.html#ProtocolConstants"><span class="hs-identifier">ProtocolConstants</span></a></a><span>
</span><a name="line-215"></a><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- | Security parameter from the paper.</span><span>
</span><a name="line-216"></a><span>      </span><a name="pcK"><a href="Pos.Core.Genesis.Types.html#pcK"><span class="hs-identifier">pcK</span></a></a><span>             </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-217"></a><span>      </span><span class="hs-comment">-- | Magic constant for separating real/testnet.</span><span>
</span><a name="line-218"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pcProtocolMagic"><a href="Pos.Core.Genesis.Types.html#pcProtocolMagic"><span class="hs-identifier">pcProtocolMagic</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int32</span><span>
</span><a name="line-219"></a><span>      </span><span class="hs-comment">-- | VSS certificates max timeout to live (number of epochs).</span><span>
</span><a name="line-220"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pcVssMaxTTL"><a href="Pos.Core.Genesis.Types.html#pcVssMaxTTL"><span class="hs-identifier">pcVssMaxTTL</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Word32</span><span>
</span><a name="line-221"></a><span>      </span><span class="hs-comment">-- | VSS certificates min timeout to live (number of epochs).</span><span>
</span><a name="line-222"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pcVssMinTTL"><a href="Pos.Core.Genesis.Types.html#pcVssMinTTL"><span class="hs-identifier">pcVssMinTTL</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Word32</span><span>
</span><a name="line-223"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span class="hs-comment">-- | Specification how to generate full genesis data.</span><span>
</span><a name="line-226"></a><span class="hs-keyword">data</span><span> </span><a name="GenesisSpec"><a href="Pos.Core.Genesis.Types.html#GenesisSpec"><span class="hs-identifier">GenesisSpec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="UnsafeGenesisSpec"><a href="Pos.Core.Genesis.Types.html#UnsafeGenesisSpec"><span class="hs-identifier">UnsafeGenesisSpec</span></a></a><span>
</span><a name="line-227"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="gsAvvmDistr"><a href="Pos.Core.Genesis.Types.html#gsAvvmDistr"><span class="hs-identifier">gsAvvmDistr</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#GenesisAvvmBalances"><span class="hs-identifier hs-type">GenesisAvvmBalances</span></a><span>
</span><a name="line-228"></a><span>    </span><span class="hs-comment">-- ^ Genesis data describes avvm utxo.</span><span>
</span><a name="line-229"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="gsFtsSeed"><a href="Pos.Core.Genesis.Types.html#gsFtsSeed"><span class="hs-identifier">gsFtsSeed</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Types.html#SharedSeed"><span class="hs-identifier hs-type">SharedSeed</span></a><span>
</span><a name="line-230"></a><span>    </span><span class="hs-comment">-- ^ Seed for FTS for 0-th epoch.</span><span>
</span><a name="line-231"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="gsHeavyDelegation"><a href="Pos.Core.Genesis.Types.html#gsHeavyDelegation"><span class="hs-identifier">gsHeavyDelegation</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#GenesisDelegation"><span class="hs-identifier hs-type">GenesisDelegation</span></a><span>
</span><a name="line-232"></a><span>    </span><span class="hs-comment">-- ^ Genesis state of heavyweight delegation.</span><span>
</span><a name="line-233"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="gsBlockVersionData"><a href="Pos.Core.Genesis.Types.html#gsBlockVersionData"><span class="hs-identifier">gsBlockVersionData</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Types.html#BlockVersionData"><span class="hs-identifier hs-type">BlockVersionData</span></a><span>
</span><a name="line-234"></a><span>    </span><span class="hs-comment">-- ^ Genesis 'BlockVersionData'.</span><span>
</span><a name="line-235"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="gsProtocolConstants"><a href="Pos.Core.Genesis.Types.html#gsProtocolConstants"><span class="hs-identifier">gsProtocolConstants</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#ProtocolConstants"><span class="hs-identifier hs-type">ProtocolConstants</span></a><span>
</span><a name="line-236"></a><span>    </span><span class="hs-comment">-- ^ Other constants which affect consensus.</span><span>
</span><a name="line-237"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="gsInitializer"><a href="Pos.Core.Genesis.Types.html#gsInitializer"><span class="hs-identifier">gsInitializer</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#GenesisInitializer"><span class="hs-identifier hs-type">GenesisInitializer</span></a><span>
</span><a name="line-238"></a><span>    </span><span class="hs-comment">-- ^ Other data which depend on genesis type.</span><span>
</span><a name="line-239"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span class="hs-comment">-- | Safe constructor for 'GenesisSpec'. Throws error if something</span><span>
</span><a name="line-242"></a><span class="hs-comment">-- goes wrong.</span><span>
</span><a name="line-243"></a><span class="hs-identifier">mkGenesisSpec</span><span>
</span><a name="line-244"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisAvvmBalances"><span class="hs-identifier hs-type">GenesisAvvmBalances</span></a><span>
</span><a name="line-245"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pos.Core.Types.html#SharedSeed"><span class="hs-identifier hs-type">SharedSeed</span></a><span>
</span><a name="line-246"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisDelegation"><span class="hs-identifier hs-type">GenesisDelegation</span></a><span>
</span><a name="line-247"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pos.Core.Types.html#BlockVersionData"><span class="hs-identifier hs-type">BlockVersionData</span></a><span>
</span><a name="line-248"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pos.Core.Genesis.Types.html#ProtocolConstants"><span class="hs-identifier hs-type">ProtocolConstants</span></a><span>
</span><a name="line-249"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisInitializer"><span class="hs-identifier hs-type">GenesisInitializer</span></a><span>
</span><a name="line-250"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisSpec"><span class="hs-identifier hs-type">GenesisSpec</span></a><span>
</span><a name="line-251"></a><a name="mkGenesisSpec"><a href="Pos.Core.Genesis.Types.html#mkGenesisSpec"><span class="hs-identifier">mkGenesisSpec</span></a></a><span> </span><a name="local-6989586621680341167"><a href="#local-6989586621680341167"><span class="hs-identifier">avvmDistr</span></a></a><span> </span><a name="local-6989586621680341168"><a href="#local-6989586621680341168"><span class="hs-identifier">seed</span></a></a><span> </span><a name="local-6989586621680341169"><a href="#local-6989586621680341169"><span class="hs-identifier">delega</span></a></a><span> </span><a name="local-6989586621680341170"><a href="#local-6989586621680341170"><span class="hs-identifier">bvd</span></a></a><span> </span><a name="local-6989586621680341171"><a href="#local-6989586621680341171"><span class="hs-identifier">pc</span></a></a><span> </span><a name="local-6989586621680341172"><a href="#local-6989586621680341172"><span class="hs-identifier">specType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-252"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680341173"><a href="#local-6989586621680341173"><span class="hs-identifier">avvmKeys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">HM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">keys</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">getGenesisAvvmBalances</span><span> </span><a href="#local-6989586621680341167"><span class="hs-identifier hs-var">avvmDistr</span></a><span>
</span><a name="line-253"></a><span>    </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">allDistinct</span><span> </span><a href="#local-6989586621680341173"><span class="hs-identifier hs-var">avvmKeys</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-254"></a><span>        </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;mkGenesisSpec: there are duplicates in avvm balances&quot;</span><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span>    </span><span class="hs-comment">-- All checks passed</span><span>
</span><a name="line-257"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Pos.Core.Genesis.Types.html#UnsafeGenesisSpec"><span class="hs-identifier hs-var">UnsafeGenesisSpec</span></a><span> </span><a href="#local-6989586621680341167"><span class="hs-identifier hs-var">avvmDistr</span></a><span> </span><a href="#local-6989586621680341168"><span class="hs-identifier hs-var">seed</span></a><span> </span><a href="#local-6989586621680341169"><span class="hs-identifier hs-var">delega</span></a><span> </span><a href="#local-6989586621680341170"><span class="hs-identifier hs-var">bvd</span></a><span> </span><a href="#local-6989586621680341171"><span class="hs-identifier hs-var">pc</span></a><span> </span><a href="#local-6989586621680341172"><span class="hs-identifier hs-var">specType</span></a><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-260"></a><span class="hs-comment">-- GenesisData</span><span>
</span><a name="line-261"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span class="hs-comment">-- | Genesis data contains all data which determines consensus</span><span>
</span><a name="line-264"></a><span class="hs-comment">-- rules. It must be same for all nodes. It's used to initialize</span><span>
</span><a name="line-265"></a><span class="hs-comment">-- global state, slotting, etc.</span><span>
</span><a name="line-266"></a><span class="hs-keyword">data</span><span> </span><a name="GenesisData"><a href="Pos.Core.Genesis.Types.html#GenesisData"><span class="hs-identifier">GenesisData</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="GenesisData"><a href="Pos.Core.Genesis.Types.html#GenesisData"><span class="hs-identifier">GenesisData</span></a></a><span>
</span><a name="line-267"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="gdBootStakeholders"><a href="Pos.Core.Genesis.Types.html#gdBootStakeholders"><span class="hs-identifier">gdBootStakeholders</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#GenesisWStakeholders"><span class="hs-identifier hs-type">GenesisWStakeholders</span></a><span>
</span><a name="line-268"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="gdHeavyDelegation"><a href="Pos.Core.Genesis.Types.html#gdHeavyDelegation"><span class="hs-identifier">gdHeavyDelegation</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#GenesisDelegation"><span class="hs-identifier hs-type">GenesisDelegation</span></a><span>
</span><a name="line-269"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="gdStartTime"><a href="Pos.Core.Genesis.Types.html#gdStartTime"><span class="hs-identifier">gdStartTime</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Timestamp.html#Timestamp"><span class="hs-identifier hs-type">Timestamp</span></a><span>
</span><a name="line-270"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="gdVssCerts"><a href="Pos.Core.Genesis.Types.html#gdVssCerts"><span class="hs-identifier">gdVssCerts</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#GenesisVssCertificatesMap"><span class="hs-identifier hs-type">GenesisVssCertificatesMap</span></a><span>
</span><a name="line-271"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="gdNonAvvmBalances"><a href="Pos.Core.Genesis.Types.html#gdNonAvvmBalances"><span class="hs-identifier">gdNonAvvmBalances</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#GenesisNonAvvmBalances"><span class="hs-identifier hs-type">GenesisNonAvvmBalances</span></a><span>
</span><a name="line-272"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="gdBlockVersionData"><a href="Pos.Core.Genesis.Types.html#gdBlockVersionData"><span class="hs-identifier">gdBlockVersionData</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Types.html#BlockVersionData"><span class="hs-identifier hs-type">BlockVersionData</span></a><span>
</span><a name="line-273"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="gdProtocolConsts"><a href="Pos.Core.Genesis.Types.html#gdProtocolConsts"><span class="hs-identifier">gdProtocolConsts</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#ProtocolConstants"><span class="hs-identifier hs-type">ProtocolConstants</span></a><span>
</span><a name="line-274"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="gdAvvmDistr"><a href="Pos.Core.Genesis.Types.html#gdAvvmDistr"><span class="hs-identifier">gdAvvmDistr</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Genesis.Types.html#GenesisAvvmBalances"><span class="hs-identifier hs-type">GenesisAvvmBalances</span></a><span>
</span><a name="line-275"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="gdFtsSeed"><a href="Pos.Core.Genesis.Types.html#gdFtsSeed"><span class="hs-identifier">gdFtsSeed</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Pos.Core.Types.html#SharedSeed"><span class="hs-identifier hs-type">SharedSeed</span></a><span>
</span><a name="line-276"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">)</span><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span class="hs-comment">-- | 'GenesisData' is determined by 'GenesisSpec' whenever it has a</span><span>
</span><a name="line-279"></a><span class="hs-comment">-- 'MainnetInitializer'.</span><span>
</span><a name="line-280"></a><span class="hs-identifier">genesisDataFromSpec</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisSpec"><span class="hs-identifier hs-type">GenesisSpec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisData"><span class="hs-identifier hs-type">GenesisData</span></a><span>
</span><a name="line-281"></a><a name="genesisDataFromSpec"><a href="Pos.Core.Genesis.Types.html#genesisDataFromSpec"><span class="hs-identifier">genesisDataFromSpec</span></a></a><span> </span><a href="Pos.Core.Genesis.Types.html#UnsafeGenesisSpec"><span class="hs-identifier hs-var">UnsafeGenesisSpec</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span>
</span><a name="line-282"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Pos.Core.Genesis.Types.html#MainnetInitializer"><span class="hs-identifier hs-var">MainnetInitializer</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680341179"><span class="hs-identifier hs-var">gsInitializer</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-283"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680341184"><a href="#local-6989586621680341184"><span class="hs-identifier">gdBootStakeholders</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680341181"><span class="hs-identifier hs-var">miBootStakeholders</span></a><span>
</span><a name="line-284"></a><span>            </span><a name="local-6989586621680341185"><a href="#local-6989586621680341185"><span class="hs-identifier">gdHeavyDelegation</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680341176"><span class="hs-identifier hs-var">gsHeavyDelegation</span></a><span>
</span><a name="line-285"></a><span>            </span><a name="local-6989586621680341186"><a href="#local-6989586621680341186"><span class="hs-identifier">gdStartTime</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680341180"><span class="hs-identifier hs-var">miStartTime</span></a><span>
</span><a name="line-286"></a><span>            </span><a name="local-6989586621680341187"><a href="#local-6989586621680341187"><span class="hs-identifier">gdVssCerts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680341182"><span class="hs-identifier hs-var">miVssCerts</span></a><span>
</span><a name="line-287"></a><span>            </span><a name="local-6989586621680341188"><a href="#local-6989586621680341188"><span class="hs-identifier">gdNonAvvmBalances</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680341183"><span class="hs-identifier hs-var">miNonAvvmBalances</span></a><span>
</span><a name="line-288"></a><span>            </span><a name="local-6989586621680341189"><a href="#local-6989586621680341189"><span class="hs-identifier">gdBlockVersionData</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680341177"><span class="hs-identifier hs-var">gsBlockVersionData</span></a><span>
</span><a name="line-289"></a><span>            </span><a name="local-6989586621680341190"><a href="#local-6989586621680341190"><span class="hs-identifier">gdProtocolConsts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680341178"><span class="hs-identifier hs-var">gsProtocolConstants</span></a><span>
</span><a name="line-290"></a><span>            </span><a name="local-6989586621680341191"><a href="#local-6989586621680341191"><span class="hs-identifier">gdAvvmDistr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680341174"><span class="hs-identifier hs-var">gsAvvmDistr</span></a><span>
</span><a name="line-291"></a><span>            </span><a name="local-6989586621680341192"><a href="#local-6989586621680341192"><span class="hs-identifier">gdFtsSeed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680341175"><span class="hs-identifier hs-var">gsFtsSeed</span></a><span>
</span><a name="line-292"></a><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="Pos.Core.Genesis.Types.html#GenesisData"><span class="hs-identifier hs-var">GenesisData</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span>
</span><a name="line-293"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-294"></a></pre></body></html>