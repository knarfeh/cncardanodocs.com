<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module:      Pos.Util.Queue
Description: A simple functional queue

This impl is ok and is O(1) amortised time provided that the use of
dequeue is non-persistent style, meaning that we never call dequeue
twice on the same value. In the case of
'Pos.Util.Concurrent.PriorityLock', where this is intended to be used,
that's true because it will be the unlocking thread that does the
dequeue.

An alternative impl that would be suitable in other cases would do the
reversing on the enqueue side.
-}</span><span>
</span><a name="line-15"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span><span class="hs-operator">.</span><span class="hs-identifier">Queue</span><span>
</span><a name="line-16"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Pos.Util.Queue.html#Q"><span class="hs-identifier hs-type">Q</span></a><span>
</span><a name="line-17"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Pos.Util.Queue.html#queue"><span class="hs-identifier hs-var">queue</span></a><span>
</span><a name="line-18"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Pos.Util.Queue.html#enqueue"><span class="hs-identifier hs-var">enqueue</span></a><span>
</span><a name="line-19"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Pos.Util.Queue.html#dequeue"><span class="hs-identifier hs-var">dequeue</span></a><span>
</span><a name="line-20"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Universum</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-keyword">data</span><span> </span><a name="Q"><a href="Pos.Util.Queue.html#Q"><span class="hs-identifier">Q</span></a></a><span> </span><a name="local-6989586621679253302"><a href="#local-6989586621679253302"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Q"><a href="Pos.Util.Queue.html#Q"><span class="hs-identifier">Q</span></a></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679253302"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679253302"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-identifier">queue</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679253305"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pos.Util.Queue.html#Q"><span class="hs-identifier hs-type">Q</span></a><span> </span><a href="#local-6989586621679253305"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-27"></a><a name="queue"><a href="Pos.Util.Queue.html#queue"><span class="hs-identifier">queue</span></a></a><span> </span><a name="local-6989586621679253306"><a href="#local-6989586621679253306"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Util.Queue.html#Q"><span class="hs-identifier hs-var">Q</span></a><span> </span><a href="#local-6989586621679253306"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span class="hs-identifier">enqueue</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pos.Util.Queue.html#Q"><span class="hs-identifier hs-type">Q</span></a><span> </span><a href="#local-6989586621679253304"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679253304"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pos.Util.Queue.html#Q"><span class="hs-identifier hs-type">Q</span></a><span> </span><a href="#local-6989586621679253304"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-30"></a><a name="enqueue"><a href="Pos.Util.Queue.html#enqueue"><span class="hs-identifier">enqueue</span></a></a><span> </span><span class="hs-special">(</span><a href="Pos.Util.Queue.html#Q"><span class="hs-identifier hs-var">Q</span></a><span> </span><a name="local-6989586621679253307"><a href="#local-6989586621679253307"><span class="hs-identifier">front</span></a></a><span>  </span><a name="local-6989586621679253308"><a href="#local-6989586621679253308"><span class="hs-identifier">back</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679253309"><a href="#local-6989586621679253309"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Util.Queue.html#Q"><span class="hs-identifier hs-var">Q</span></a><span> </span><a href="#local-6989586621679253307"><span class="hs-identifier hs-var">front</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679253309"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679253308"><span class="hs-identifier hs-var">back</span></a><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-identifier">dequeue</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pos.Util.Queue.html#Q"><span class="hs-identifier hs-type">Q</span></a><span> </span><a href="#local-6989586621679253303"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679253303"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Pos.Util.Queue.html#Q"><span class="hs-identifier hs-type">Q</span></a><span> </span><a href="#local-6989586621679253303"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-33"></a><a name="dequeue"><a href="Pos.Util.Queue.html#dequeue"><span class="hs-identifier">dequeue</span></a></a><span> </span><span class="hs-special">(</span><a href="Pos.Util.Queue.html#Q"><span class="hs-identifier hs-var">Q</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679253310"><a href="#local-6989586621679253310"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679253311"><a href="#local-6989586621679253311"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679253312"><a href="#local-6989586621679253312"><span class="hs-identifier">back</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679253310"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="Pos.Util.Queue.html#Q"><span class="hs-identifier hs-var">Q</span></a><span> </span><a href="#local-6989586621679253311"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621679253312"><span class="hs-identifier hs-var">back</span></a><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span class="hs-identifier">dequeue</span><span> </span><span class="hs-special">(</span><a href="Pos.Util.Queue.html#Q"><span class="hs-identifier hs-var">Q</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><a name="local-6989586621679253313"><a href="#local-6989586621679253313"><span class="hs-identifier">back</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621679253313"><span class="hs-identifier hs-var">back</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-35"></a><span>                               </span><a name="local-6989586621679253314"><a href="#local-6989586621679253314"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679253315"><a href="#local-6989586621679253315"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679253314"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="Pos.Util.Queue.html#Q"><span class="hs-identifier hs-var">Q</span></a><span> </span><a href="#local-6989586621679253315"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span>                               </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-37"></a></pre></body></html>