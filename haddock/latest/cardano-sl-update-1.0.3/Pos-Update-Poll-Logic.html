<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Pos.Update.Poll.Logic</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Pos-Update-Poll-Logic.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Pos.Update.Poll.Logic.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">cardano-sl-update-1.0.3: Cardano SL - update</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Pos.Update.Poll.Logic</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Base</a></li><li><a href="#g:2">Softfork resolution</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Functions which operate on MonadPoll[Read]. Business logic of
 Update System.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:verifyAndApplyUSPayload">verifyAndApplyUSPayload</a> :: ApplyMode m =&gt; <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:SlotId">SlotId</a> (<a href="../cardano-sl-core-1.0.3/Pos-Util-Util.html#t:Some">Some</a> <a href="../cardano-sl-core-1.0.3/Pos-Core-Class.html#t:IsMainHeader">IsMainHeader</a>) -&gt; <a href="Pos-Update-Core-Types.html#t:UpdatePayload">UpdatePayload</a> -&gt; m ()</li><li class="src short"><a href="#v:rollbackUS">rollbackUS</a> :: <span class="keyword">forall</span> m. <a href="Pos-Update-Poll-Class.html#t:MonadPoll">MonadPoll</a> m =&gt; <a href="Pos-Update-Poll-Types.html#t:USUndo">USUndo</a> -&gt; m ()</li><li class="src short"><a href="#v:normalizePoll">normalizePoll</a> :: (<a href="Pos-Update-Poll-Class.html#t:MonadPoll">MonadPoll</a> m, <a href="../cardano-sl-core-1.0.3/Pos-Core-Configuration.html#t:HasConfiguration">HasConfiguration</a>) =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:SlotId">SlotId</a> -&gt; <a href="Pos-Update-Core-Types.html#t:UpdateProposals">UpdateProposals</a> -&gt; <a href="Pos-Update-Core-Types.html#t:LocalVotes">LocalVotes</a> -&gt; m (<a href="Pos-Update-Core-Types.html#t:UpdateProposals">UpdateProposals</a>, <a href="Pos-Update-Core-Types.html#t:LocalVotes">LocalVotes</a>)</li><li class="src short"><a href="#v:refreshPoll">refreshPoll</a> :: (<a href="Pos-Update-Poll-Class.html#t:MonadPoll">MonadPoll</a> m, <a href="../cardano-sl-core-1.0.3/Pos-Core-Configuration.html#t:HasConfiguration">HasConfiguration</a>) =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:SlotId">SlotId</a> -&gt; <a href="Pos-Update-Core-Types.html#t:UpdateProposals">UpdateProposals</a> -&gt; <a href="Pos-Update-Core-Types.html#t:LocalVotes">LocalVotes</a> -&gt; m (<a href="Pos-Update-Core-Types.html#t:UpdateProposals">UpdateProposals</a>, <a href="Pos-Update-Core-Types.html#t:LocalVotes">LocalVotes</a>)</li><li class="src short"><a href="#v:filterProposalsByThd">filterProposalsByThd</a> :: <span class="keyword">forall</span> m. <a href="Pos-Update-Poll-Class.html#t:MonadPollRead">MonadPollRead</a> m =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:EpochIndex">EpochIndex</a> -&gt; <a href="Pos-Update-Core-Types.html#t:UpdateProposals">UpdateProposals</a> -&gt; m (<a href="Pos-Update-Core-Types.html#t:UpdateProposals">UpdateProposals</a>, HashSet <a href="Pos-Update-Core-Types.html#t:UpId">UpId</a>)</li><li class="src short"><a href="#v:canCreateBlockBV">canCreateBlockBV</a> :: <a href="Pos-Update-Poll-Class.html#t:MonadPollRead">MonadPollRead</a> m =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:BlockVersion">BlockVersion</a> -&gt; m <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:processGenesisBlock">processGenesisBlock</a> :: <span class="keyword">forall</span> m. (<a href="../cardano-sl-core-1.0.3/Pos-Core-Configuration.html#t:HasConfiguration">HasConfiguration</a>, MonadError <a href="Pos-Update-Poll-Failure.html#t:PollVerFailure">PollVerFailure</a> m, <a href="Pos-Update-Poll-Class.html#t:MonadPoll">MonadPoll</a> m) =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:EpochIndex">EpochIndex</a> -&gt; m ()</li><li class="src short"><a href="#v:recordBlockIssuance">recordBlockIssuance</a> :: (<a href="../cardano-sl-core-1.0.3/Pos-Core-Configuration.html#t:HasConfiguration">HasConfiguration</a>, MonadError <a href="Pos-Update-Poll-Failure.html#t:PollVerFailure">PollVerFailure</a> m, <a href="Pos-Update-Poll-Class.html#t:MonadPoll">MonadPoll</a> m) =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:StakeholderId">StakeholderId</a> -&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:BlockVersion">BlockVersion</a> -&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:SlotId">SlotId</a> -&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:HeaderHash">HeaderHash</a> -&gt; m ()</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:verifyAndApplyUSPayload" class="def">verifyAndApplyUSPayload</a> :: ApplyMode m =&gt; <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:SlotId">SlotId</a> (<a href="../cardano-sl-core-1.0.3/Pos-Util-Util.html#t:Some">Some</a> <a href="../cardano-sl-core-1.0.3/Pos-Core-Class.html#t:IsMainHeader">IsMainHeader</a>) -&gt; <a href="Pos-Update-Core-Types.html#t:UpdatePayload">UpdatePayload</a> -&gt; m () <a href="src/Pos.Update.Poll.Logic.Apply.html#verifyAndApplyUSPayload" class="link">Source</a> <a href="#v:verifyAndApplyUSPayload" class="selflink">#</a></p><div class="doc"><p>Verify UpdatePayload with respect to data provided by
 MonadPoll. If data is valid it is also applied.  Otherwise
 PollVerificationFailure is thrown using MonadError type class.</p><p>The first argument specifies whether we should perform unknown data
 checks.  Currently it means that if it's <code><a href="../base-4.9.1.0/Data-Bool.html#v:True">True</a></code>, then proposal (if
 it exists) must not have unknown attributes.</p><p>When the second argument is 'Left epoch', it means that temporary payload
 for given slot is applied. In this case threshold for inclusion of proposal
 into block is intentionally not checked.
 When it is 'Right header', it means that payload from block with
 given header is applied and in this case threshold for update proposal is
 checked.</p></div></div><div class="top"><p class="src"><a id="v:rollbackUS" class="def">rollbackUS</a> :: <span class="keyword">forall</span> m. <a href="Pos-Update-Poll-Class.html#t:MonadPoll">MonadPoll</a> m =&gt; <a href="Pos-Update-Poll-Types.html#t:USUndo">USUndo</a> -&gt; m () <a href="src/Pos.Update.Poll.Logic.Rollback.html#rollbackUS" class="link">Source</a> <a href="#v:rollbackUS" class="selflink">#</a></p><div class="doc"><p>Rollback application of UpdatePayload in MonadPoll using payload
 itself and undo data.</p></div></div><div class="top"><p class="src"><a id="v:normalizePoll" class="def">normalizePoll</a> :: (<a href="Pos-Update-Poll-Class.html#t:MonadPoll">MonadPoll</a> m, <a href="../cardano-sl-core-1.0.3/Pos-Core-Configuration.html#t:HasConfiguration">HasConfiguration</a>) =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:SlotId">SlotId</a> -&gt; <a href="Pos-Update-Core-Types.html#t:UpdateProposals">UpdateProposals</a> -&gt; <a href="Pos-Update-Core-Types.html#t:LocalVotes">LocalVotes</a> -&gt; m (<a href="Pos-Update-Core-Types.html#t:UpdateProposals">UpdateProposals</a>, <a href="Pos-Update-Core-Types.html#t:LocalVotes">LocalVotes</a>) <a href="src/Pos.Update.Poll.Logic.Normalize.html#normalizePoll" class="link">Source</a> <a href="#v:normalizePoll" class="selflink">#</a></p><div class="doc"><p>Normalize given proposals and votes with respect to current Poll
 state, i. e. apply all valid data and discard invalid data.  This
 function doesn't consider threshold which determines whether a
 proposal can be put into a block.</p></div></div><div class="top"><p class="src"><a id="v:refreshPoll" class="def">refreshPoll</a> :: (<a href="Pos-Update-Poll-Class.html#t:MonadPoll">MonadPoll</a> m, <a href="../cardano-sl-core-1.0.3/Pos-Core-Configuration.html#t:HasConfiguration">HasConfiguration</a>) =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:SlotId">SlotId</a> -&gt; <a href="Pos-Update-Core-Types.html#t:UpdateProposals">UpdateProposals</a> -&gt; <a href="Pos-Update-Core-Types.html#t:LocalVotes">LocalVotes</a> -&gt; m (<a href="Pos-Update-Core-Types.html#t:UpdateProposals">UpdateProposals</a>, <a href="Pos-Update-Core-Types.html#t:LocalVotes">LocalVotes</a>) <a href="src/Pos.Update.Poll.Logic.Normalize.html#refreshPoll" class="link">Source</a> <a href="#v:refreshPoll" class="selflink">#</a></p><div class="doc"><p>This function can be used to refresh mem pool consisting of given
 proposals and votes. It applies the most valuable data and discards
 everything else.</p></div></div><div class="top"><p class="src"><a id="v:filterProposalsByThd" class="def">filterProposalsByThd</a> :: <span class="keyword">forall</span> m. <a href="Pos-Update-Poll-Class.html#t:MonadPollRead">MonadPollRead</a> m =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:EpochIndex">EpochIndex</a> -&gt; <a href="Pos-Update-Core-Types.html#t:UpdateProposals">UpdateProposals</a> -&gt; m (<a href="Pos-Update-Core-Types.html#t:UpdateProposals">UpdateProposals</a>, HashSet <a href="Pos-Update-Core-Types.html#t:UpId">UpId</a>) <a href="src/Pos.Update.Poll.Logic.Normalize.html#filterProposalsByThd" class="link">Source</a> <a href="#v:filterProposalsByThd" class="selflink">#</a></p><div class="doc"><p>Leave only those proposals which have enough stake for inclusion into
 block according to <code><a href="Pos-Update-Core-Types.html#v:bvdUpdateProposalThd">bvdUpdateProposalThd</a></code>. Note that this function is
 read-only.</p></div></div><h1 id="g:1">Base</h1><div class="top"><p class="src"><a id="v:canCreateBlockBV" class="def">canCreateBlockBV</a> :: <a href="Pos-Update-Poll-Class.html#t:MonadPollRead">MonadPollRead</a> m =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:BlockVersion">BlockVersion</a> -&gt; m <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="src/Pos.Update.Poll.Logic.Base.html#canCreateBlockBV" class="link">Source</a> <a href="#v:canCreateBlockBV" class="selflink">#</a></p><div class="doc"><p>Check whether block with given <code><a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:BlockVersion">BlockVersion</a></code> can be created
 according to current Poll.</p><p>Specifically, one of the following conditions must be true.
 &#8226; Given block version is equal to last adopted block version.
 &#8226; '(major, minor)' of given block version is greater than
 '(major, minor)' of adopted block version and this block version
 is confirmed.</p></div></div><h1 id="g:2">Softfork resolution</h1><div class="top"><p class="src"><a id="v:processGenesisBlock" class="def">processGenesisBlock</a> :: <span class="keyword">forall</span> m. (<a href="../cardano-sl-core-1.0.3/Pos-Core-Configuration.html#t:HasConfiguration">HasConfiguration</a>, MonadError <a href="Pos-Update-Poll-Failure.html#t:PollVerFailure">PollVerFailure</a> m, <a href="Pos-Update-Poll-Class.html#t:MonadPoll">MonadPoll</a> m) =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:EpochIndex">EpochIndex</a> -&gt; m () <a href="src/Pos.Update.Poll.Logic.Softfork.html#processGenesisBlock" class="link">Source</a> <a href="#v:processGenesisBlock" class="selflink">#</a></p><div class="doc"><p>Process creation of genesis block for given epoch.</p></div></div><div class="top"><p class="src"><a id="v:recordBlockIssuance" class="def">recordBlockIssuance</a> :: (<a href="../cardano-sl-core-1.0.3/Pos-Core-Configuration.html#t:HasConfiguration">HasConfiguration</a>, MonadError <a href="Pos-Update-Poll-Failure.html#t:PollVerFailure">PollVerFailure</a> m, <a href="Pos-Update-Poll-Class.html#t:MonadPoll">MonadPoll</a> m) =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:StakeholderId">StakeholderId</a> -&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:BlockVersion">BlockVersion</a> -&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:SlotId">SlotId</a> -&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:HeaderHash">HeaderHash</a> -&gt; m () <a href="src/Pos.Update.Poll.Logic.Softfork.html#recordBlockIssuance" class="link">Source</a> <a href="#v:recordBlockIssuance" class="selflink">#</a></p><div class="doc"><p>Record the fact that main block with given version and leader has
 been issued by for the given slot.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.3</p></div></body></html>