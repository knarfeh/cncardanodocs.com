<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Pos.Update.Logic.Global</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Pos-Update-Logic-Global.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Pos.Update.Logic.Global.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">cardano-sl-update-1.0.3: Cardano SL - update</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Pos.Update.Logic.Global</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Logic of local data processing in Update System.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:usApplyBlocks">usApplyBlocks</a> :: (MonadThrow m, USGlobalApplyMode ctx m) =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:OldestFirst">OldestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> <a href="Pos-Update-Core-Types.html#t:UpdateBlock">UpdateBlock</a> -&gt; <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Pos-Update-Poll-Types.html#t:PollModifier">PollModifier</a> -&gt; m [<a href="../cardano-sl-db-1.0.3/Pos-DB-BatchOp.html#t:SomeBatchOp">SomeBatchOp</a>]</li><li class="src short"><a href="#v:usCanCreateBlock">usCanCreateBlock</a> :: (WithLogger m, <a href="../base-4.9.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m, <a href="../cardano-sl-db-1.0.3/Pos-DB-Class.html#t:MonadDBRead">MonadDBRead</a> m, MonadReader ctx m, <a href="../cardano-sl-core-1.0.3/Pos-Util-Util.html#t:HasLens">HasLens</a> <a href="../cardano-sl-lrc-1.0.3/Pos-Lrc-Context.html#t:LrcContext">LrcContext</a> ctx <a href="../cardano-sl-lrc-1.0.3/Pos-Lrc-Context.html#t:LrcContext">LrcContext</a>, <a href="../cardano-sl-core-1.0.3/Pos-Core-Configuration.html#t:HasConfiguration">HasConfiguration</a>, <a href="Pos-Update-Configuration.html#t:HasUpdateConfiguration">HasUpdateConfiguration</a>) =&gt; m <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:usRollbackBlocks">usRollbackBlocks</a> :: <span class="keyword">forall</span> ctx m. USGlobalApplyMode ctx m =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NewestFirst">NewestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> (<a href="Pos-Update-Core-Types.html#t:UpdateBlock">UpdateBlock</a>, <a href="Pos-Update-Poll-Types.html#t:USUndo">USUndo</a>) -&gt; m [<a href="../cardano-sl-db-1.0.3/Pos-DB-BatchOp.html#t:SomeBatchOp">SomeBatchOp</a>]</li><li class="src short"><a href="#v:usVerifyBlocks">usVerifyBlocks</a> :: (USGlobalVerifyMode ctx m, <a href="../cardano-sl-infra-1.0.3/Pos-Reporting-Methods.html#t:MonadReporting">MonadReporting</a> ctx m) =&gt; <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:OldestFirst">OldestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> <a href="Pos-Update-Core-Types.html#t:UpdateBlock">UpdateBlock</a> -&gt; m (<a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> <a href="Pos-Update-Poll-Failure.html#t:PollVerFailure">PollVerFailure</a> (<a href="Pos-Update-Poll-Types.html#t:PollModifier">PollModifier</a>, <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:OldestFirst">OldestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> <a href="Pos-Update-Poll-Types.html#t:USUndo">USUndo</a>))</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:usApplyBlocks" class="def">usApplyBlocks</a> :: (MonadThrow m, USGlobalApplyMode ctx m) =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:OldestFirst">OldestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> <a href="Pos-Update-Core-Types.html#t:UpdateBlock">UpdateBlock</a> -&gt; <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Pos-Update-Poll-Types.html#t:PollModifier">PollModifier</a> -&gt; m [<a href="../cardano-sl-db-1.0.3/Pos-DB-BatchOp.html#t:SomeBatchOp">SomeBatchOp</a>] <a href="src/Pos.Update.Logic.Global.html#usApplyBlocks" class="link">Source</a> <a href="#v:usApplyBlocks" class="selflink">#</a></p><div class="doc"><p>Apply chain of <em>definitely</em> valid blocks to US part of GState DB
 and to US local data. This function assumes that no other thread
 applies block in parallel. It also assumes that parent of oldest
 block is current tip.  If verification is done prior to
 application, one can pass <code><a href="Pos-Update-Poll-Types.html#t:PollModifier">PollModifier</a></code> obtained from verification
 to this function.</p><p>This function also updates in-memory state of slotting
 (<code><a href="../cardano-sl-infra-1.0.3/Pos-Slotting-MemState.html#t:MonadSlotsData">MonadSlotsData</a></code>) whenever it should be updated. Note that at this
 point we can't be sure that blocks will be eventually applied to
 DB. So it can happen that we update in-memory data, but don't
 update DB. However, it's not a problem, because slotting data is
 stable, i. e. once we know it for some epoch, we can be sure it
 will never change. Also note that we store slotting data for all
 epochs in memory, so adding new one can't make anything worse.</p></div></div><div class="top"><p class="src"><a id="v:usCanCreateBlock" class="def">usCanCreateBlock</a> :: (WithLogger m, <a href="../base-4.9.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m, <a href="../cardano-sl-db-1.0.3/Pos-DB-Class.html#t:MonadDBRead">MonadDBRead</a> m, MonadReader ctx m, <a href="../cardano-sl-core-1.0.3/Pos-Util-Util.html#t:HasLens">HasLens</a> <a href="../cardano-sl-lrc-1.0.3/Pos-Lrc-Context.html#t:LrcContext">LrcContext</a> ctx <a href="../cardano-sl-lrc-1.0.3/Pos-Lrc-Context.html#t:LrcContext">LrcContext</a>, <a href="../cardano-sl-core-1.0.3/Pos-Core-Configuration.html#t:HasConfiguration">HasConfiguration</a>, <a href="Pos-Update-Configuration.html#t:HasUpdateConfiguration">HasUpdateConfiguration</a>) =&gt; m <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="src/Pos.Update.Logic.Global.html#usCanCreateBlock" class="link">Source</a> <a href="#v:usCanCreateBlock" class="selflink">#</a></p><div class="doc"><p>Checks whether our software can create block according to current
 global state.</p></div></div><div class="top"><p class="src"><a id="v:usRollbackBlocks" class="def">usRollbackBlocks</a> :: <span class="keyword">forall</span> ctx m. USGlobalApplyMode ctx m =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NewestFirst">NewestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> (<a href="Pos-Update-Core-Types.html#t:UpdateBlock">UpdateBlock</a>, <a href="Pos-Update-Poll-Types.html#t:USUndo">USUndo</a>) -&gt; m [<a href="../cardano-sl-db-1.0.3/Pos-DB-BatchOp.html#t:SomeBatchOp">SomeBatchOp</a>] <a href="src/Pos.Update.Logic.Global.html#usRollbackBlocks" class="link">Source</a> <a href="#v:usRollbackBlocks" class="selflink">#</a></p><div class="doc"><p>Revert application of given blocks to US part of GState DB and US local
 data. The caller must ensure that the tip stored in DB is <code>headerHash</code> of
 head.</p></div></div><div class="top"><p class="src"><a id="v:usVerifyBlocks" class="def">usVerifyBlocks</a> :: (USGlobalVerifyMode ctx m, <a href="../cardano-sl-infra-1.0.3/Pos-Reporting-Methods.html#t:MonadReporting">MonadReporting</a> ctx m) =&gt; <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:OldestFirst">OldestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> <a href="Pos-Update-Core-Types.html#t:UpdateBlock">UpdateBlock</a> -&gt; m (<a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> <a href="Pos-Update-Poll-Failure.html#t:PollVerFailure">PollVerFailure</a> (<a href="Pos-Update-Poll-Types.html#t:PollModifier">PollModifier</a>, <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:OldestFirst">OldestFirst</a> <a href="../cardano-sl-core-1.0.3/Pos-Util-Chrono.html#t:NE">NE</a> <a href="Pos-Update-Poll-Types.html#t:USUndo">USUndo</a>)) <a href="src/Pos.Update.Logic.Global.html#usVerifyBlocks" class="link">Source</a> <a href="#v:usVerifyBlocks" class="selflink">#</a></p><div class="doc"><p>Verify whether sequence of blocks can be applied to US part of
 current GState DB.  This function doesn't make pure checks, they
 are assumed to be done earlier, most likely during objects
 construction.</p><p>If the first argument is <code><a href="../base-4.9.1.0/Data-Bool.html#v:True">True</a></code> it means that all data must be
 known. Currently it only means that <code>UpdateProposal</code>s must have
 only known attributes, but I can't guarantee this comment will
 always be up-to-date.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.3</p></div></body></html>