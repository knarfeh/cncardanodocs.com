<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Pos.Reporting.Metrics</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Pos-Reporting-Metrics.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Pos.Reporting.Metrics.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">cardano-sl-infra-1.0.3: Cardano SL - infrastructural</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Pos.Reporting.Metrics</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module basically combines reporting functionality with metrics.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span> <a href="#t:MetricMonitor">MetricMonitor</a> value = <a href="#v:MetricMonitor">MetricMonitor</a> {<ul class="subs"><li><a href="#v:mmReportMisbehaviour">mmReportMisbehaviour</a> :: Microsecond -&gt; <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> value -&gt; value -&gt; <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a></li><li><a href="#v:mmMisbehFormat">mmMisbehFormat</a> :: <span class="keyword">forall</span> r. Format r (value -&gt; r)</li><li><a href="#v:mmDebugFormat">mmDebugFormat</a> :: <span class="keyword">forall</span> r. <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> (Format r (value -&gt; r))</li><li><a href="#v:mmConvertValue">mmConvertValue</a> :: value -&gt; <a href="../base-4.9.1.0/Data-Int.html#t:Int64">Int64</a></li><li><a href="#v:mmState">mmState</a> :: !(<a href="Pos-Reporting-Metrics.html#t:MetricMonitorState">MetricMonitorState</a> value)</li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:MetricMonitorState">MetricMonitorState</a> value</li><li class="src short"><a href="#v:mkMetricMonitorState">mkMetricMonitorState</a> :: <a href="../base-4.9.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m =&gt; Text -&gt; Store -&gt; m (<a href="Pos-Reporting-Metrics.html#t:MetricMonitorState">MetricMonitorState</a> value)</li><li class="src short"><a href="#v:noReportMonitor">noReportMonitor</a> :: Buildable value =&gt; (value -&gt; <a href="../base-4.9.1.0/Data-Int.html#t:Int64">Int64</a>) -&gt; (<span class="keyword">forall</span> r. <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> (Format r (value -&gt; r))) -&gt; <a href="Pos-Reporting-Metrics.html#t:MetricMonitorState">MetricMonitorState</a> value -&gt; <a href="Pos-Reporting-Metrics.html#t:MetricMonitor">MetricMonitor</a> value</li><li class="src short"><a href="#v:recordValue">recordValue</a> :: (<a href="Pos-Reporting-Methods.html#t:MonadReporting">MonadReporting</a> ctx m, Mockable CurrentTime m) =&gt; <a href="Pos-Reporting-Metrics.html#t:MetricMonitor">MetricMonitor</a> value -&gt; value -&gt; m ()</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:MetricMonitor" class="def">MetricMonitor</a> value <a href="src/Pos.Reporting.Metrics.html#MetricMonitor" class="link">Source</a> <a href="#t:MetricMonitor" class="selflink">#</a></p><div class="doc"><p><code><a href="Pos-Reporting-Metrics.html#t:MetricMonitor">MetricMonitor</a></code> is primarily used to parameterize <code><a href="Pos-Reporting-Metrics.html#v:recordValue">recordValue</a></code>
 function (see below).</p><p>Note: currently this type only supports <code>Gauge</code> metric type. We can
 generalize it later if necessary.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:MetricMonitor" class="def">MetricMonitor</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:mmReportMisbehaviour" class="def">mmReportMisbehaviour</a> :: Microsecond -&gt; <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> value -&gt; value -&gt; <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a></dfn><div class="doc"><p>A predicate which determines which values should be also
 reported to reporting server, apart from tracking them in ekg.
 <code><a href="../base-4.9.1.0/Data-Maybe.html#v:Nothing">Nothing</a></code> means that value is good and shouldn't be reported at all.
 'Just isCritical' means that value should be reported and <code>isCritical</code>
 flag says whether misbehaviour is critical.</p><p>The first argument is how much time passed since last report of
 this type. The second one is previous reported value. The last
 one is the value we are processing.</p><p>A note on this type: one can imagine many things one can do with bad
 values, not only reporting it as a misbehaviour. A simple extension is
 to support other types of reports, e. g. error.
 More general approach is to permit doing arbitrary monadic action.
 Also we can use a custom ADT.
 'Maybe Bool' was choosen as a reasonable trade-off between simplicity
 and generalization.</p></div></li><li><dfn class="src"><a id="v:mmMisbehFormat" class="def">mmMisbehFormat</a> :: <span class="keyword">forall</span> r. Format r (value -&gt; r)</dfn><div class="doc"><p>A <code>Format</code> of misbehaviour message.</p></div></li><li><dfn class="src"><a id="v:mmDebugFormat" class="def">mmDebugFormat</a> :: <span class="keyword">forall</span> r. <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> (Format r (value -&gt; r))</dfn><div class="doc"><p>A <code>Format</code> of debug message which is just logged with debug
 severity (if this format is <code><a href="../base-4.9.1.0/Data-Maybe.html#v:Just">Just</a></code> and value is not reported).</p></div></li><li><dfn class="src"><a id="v:mmConvertValue" class="def">mmConvertValue</a> :: value -&gt; <a href="../base-4.9.1.0/Data-Int.html#t:Int64">Int64</a></dfn><div class="doc"><p>A way to convert abstract <code>value</code> to <code><a href="../base-4.9.1.0/Data-Int.html#t:Int64">Int64</a></code>.</p></div></li><li><dfn class="src"><a id="v:mmState" class="def">mmState</a> :: !(<a href="Pos-Reporting-Metrics.html#t:MetricMonitorState">MetricMonitorState</a> value)</dfn><div class="doc"><p>Internal state.</p></div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:MetricMonitorState" class="def">MetricMonitorState</a> value <a href="src/Pos.Reporting.Metrics.html#MetricMonitorState" class="link">Source</a> <a href="#t:MetricMonitorState" class="selflink">#</a></p><div class="doc"><p>Mutable internal state of <code><a href="Pos-Reporting-Metrics.html#t:MetricMonitor">MetricMonitor</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:mkMetricMonitorState" class="def">mkMetricMonitorState</a> :: <a href="../base-4.9.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m =&gt; Text -&gt; Store -&gt; m (<a href="Pos-Reporting-Metrics.html#t:MetricMonitorState">MetricMonitorState</a> value) <a href="src/Pos.Reporting.Metrics.html#mkMetricMonitorState" class="link">Source</a> <a href="#v:mkMetricMonitorState" class="selflink">#</a></p><div class="doc"><p>Make new initial <code><a href="Pos-Reporting-Metrics.html#t:MetricMonitorState">MetricMonitorState</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:noReportMonitor" class="def">noReportMonitor</a> <a href="src/Pos.Reporting.Metrics.html#noReportMonitor" class="link">Source</a> <a href="#v:noReportMonitor" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: Buildable value</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; (value -&gt; <a href="../base-4.9.1.0/Data-Int.html#t:Int64">Int64</a>)</td><td class="doc"><p>How to convert value to integer.</p></td></tr><tr><td class="src">-&gt; (<span class="keyword">forall</span> r. <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> (Format r (value -&gt; r)))</td><td class="doc"><p>How to format value for debug.</p></td></tr><tr><td class="src">-&gt; <a href="Pos-Reporting-Metrics.html#t:MetricMonitorState">MetricMonitorState</a> value</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Pos-Reporting-Metrics.html#t:MetricMonitor">MetricMonitor</a> value</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Make <code><a href="Pos-Reporting-Metrics.html#t:MetricMonitorState">MetricMonitorState</a></code> which never reports.</p></div></div><div class="top"><p class="src"><a id="v:recordValue" class="def">recordValue</a> :: (<a href="Pos-Reporting-Methods.html#t:MonadReporting">MonadReporting</a> ctx m, Mockable CurrentTime m) =&gt; <a href="Pos-Reporting-Metrics.html#t:MetricMonitor">MetricMonitor</a> value -&gt; value -&gt; m () <a href="src/Pos.Reporting.Metrics.html#recordValue" class="link">Source</a> <a href="#v:recordValue" class="selflink">#</a></p><div class="doc"><p>Update the value stored in the <code><a href="Pos-Reporting-Metrics.html#t:MetricMonitor">MetricMonitor</a></code>s gauge.  Report
 this value if it should be reported according to <code><a href="Pos-Reporting-Metrics.html#t:MetricMonitor">MetricMonitor</a></code>.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.3</p></div></body></html>