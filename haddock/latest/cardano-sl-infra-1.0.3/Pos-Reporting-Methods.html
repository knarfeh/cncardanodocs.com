<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Pos.Reporting.Methods</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Pos-Reporting-Methods.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Pos.Reporting.Methods.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">cardano-sl-infra-1.0.3: Cardano SL - infrastructural</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Pos.Reporting.Methods</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Report single event.</a></li><li><a href="#g:2">Exception handling</a></li><li><a href="#g:3">Internals, exported for custom usages.</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Methods of reporting different unhealthy behaviour to server.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">type</span> <a href="#t:MonadReporting">MonadReporting</a> ctx m = (<a href="../base-4.9.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m, MonadMask m, MonadReader ctx m, <a href="Pos-KnownPeers.html#t:MonadFormatPeers">MonadFormatPeers</a> m, <a href="Pos-Reporting-MemState.html#t:HasReportingContext">HasReportingContext</a> ctx, <a href="Pos-Network-Types.html#t:HasNodeType">HasNodeType</a> ctx, WithLogger m, <a href="../cardano-sl-core-1.0.3/Pos-Core-Configuration.html#t:HasConfiguration">HasConfiguration</a>)</li><li class="src short"><a href="#v:reportError">reportError</a> :: <span class="keyword">forall</span> ctx m. <a href="Pos-Reporting-Methods.html#t:MonadReporting">MonadReporting</a> ctx m =&gt; Text -&gt; m ()</li><li class="src short"><a href="#v:reportMisbehaviour">reportMisbehaviour</a> :: <span class="keyword">forall</span> ctx m. <a href="Pos-Reporting-Methods.html#t:MonadReporting">MonadReporting</a> ctx m =&gt; <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; Text -&gt; m ()</li><li class="src short"><a href="#v:reportInfo">reportInfo</a> :: <span class="keyword">forall</span> ctx m. <a href="Pos-Reporting-Methods.html#t:MonadReporting">MonadReporting</a> ctx m =&gt; <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; Text -&gt; m ()</li><li class="src short"><a href="#v:reportOrLog">reportOrLog</a> :: <span class="keyword">forall</span> ctx m. <a href="Pos-Reporting-Methods.html#t:MonadReporting">MonadReporting</a> ctx m =&gt; Severity -&gt; Text -&gt; <a href="../base-4.9.1.0/Control-Exception-Base.html#t:SomeException">SomeException</a> -&gt; m ()</li><li class="src short"><a href="#v:reportOrLogE">reportOrLogE</a> :: <span class="keyword">forall</span> ctx m. <a href="Pos-Reporting-Methods.html#t:MonadReporting">MonadReporting</a> ctx m =&gt; Text -&gt; <a href="../base-4.9.1.0/Control-Exception-Base.html#t:SomeException">SomeException</a> -&gt; m ()</li><li class="src short"><a href="#v:reportOrLogW">reportOrLogW</a> :: <span class="keyword">forall</span> ctx m. <a href="Pos-Reporting-Methods.html#t:MonadReporting">MonadReporting</a> ctx m =&gt; Text -&gt; <a href="../base-4.9.1.0/Control-Exception-Base.html#t:SomeException">SomeException</a> -&gt; m ()</li><li class="src short"><a href="#v:sendReport">sendReport</a> :: (<a href="../cardano-sl-core-1.0.3/Pos-Core-Configuration.html#t:HasConfiguration">HasConfiguration</a>, <a href="../base-4.9.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m, MonadMask m) =&gt; [<a href="../base-4.9.1.0/System-IO.html#t:FilePath">FilePath</a>] -&gt; [Text] -&gt; ReportType -&gt; Text -&gt; <a href="../base-4.9.1.0/Data-String.html#t:String">String</a> -&gt; m ()</li><li class="src short"><a href="#v:retrieveLogFiles">retrieveLogFiles</a> :: LoggerConfig -&gt; [([Text], <a href="../base-4.9.1.0/System-IO.html#t:FilePath">FilePath</a>)]</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:MonadReporting" class="def">MonadReporting</a> ctx m = (<a href="../base-4.9.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m, MonadMask m, MonadReader ctx m, <a href="Pos-KnownPeers.html#t:MonadFormatPeers">MonadFormatPeers</a> m, <a href="Pos-Reporting-MemState.html#t:HasReportingContext">HasReportingContext</a> ctx, <a href="Pos-Network-Types.html#t:HasNodeType">HasNodeType</a> ctx, WithLogger m, <a href="../cardano-sl-core-1.0.3/Pos-Core-Configuration.html#t:HasConfiguration">HasConfiguration</a>) <a href="src/Pos.Reporting.Methods.html#MonadReporting" class="link">Source</a> <a href="#t:MonadReporting" class="selflink">#</a></p></div><h1 id="g:1">Report single event.</h1><div class="top"><p class="src"><a id="v:reportError" class="def">reportError</a> :: <span class="keyword">forall</span> ctx m. <a href="Pos-Reporting-Methods.html#t:MonadReporting">MonadReporting</a> ctx m =&gt; Text -&gt; m () <a href="src/Pos.Reporting.Methods.html#reportError" class="link">Source</a> <a href="#v:reportError" class="selflink">#</a></p><div class="doc"><p>Report &#171;error&#187;, i. e. a situation when something is wrong with our
 node, e. g. an assertion failed.</p></div></div><div class="top"><p class="src"><a id="v:reportMisbehaviour" class="def">reportMisbehaviour</a> :: <span class="keyword">forall</span> ctx m. <a href="Pos-Reporting-Methods.html#t:MonadReporting">MonadReporting</a> ctx m =&gt; <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; Text -&gt; m () <a href="src/Pos.Reporting.Methods.html#reportMisbehaviour" class="link">Source</a> <a href="#v:reportMisbehaviour" class="selflink">#</a></p><div class="doc"><p>Report &#171;misbehavior&#187;, i. e. a situation when something is globally
 wrong, not only with our node. <code><a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a></code> argument determines whether
 misbehavior is critical and requires immediate response.</p><p>Misbehaviour is reported only by core nodes, because
 a) core nodes usually have the most actual vision of the current state;
 b) reporting misbehaviour from many nodes is redundant.</p></div></div><div class="top"><p class="src"><a id="v:reportInfo" class="def">reportInfo</a> :: <span class="keyword">forall</span> ctx m. <a href="Pos-Reporting-Methods.html#t:MonadReporting">MonadReporting</a> ctx m =&gt; <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; Text -&gt; m () <a href="src/Pos.Reporting.Methods.html#reportInfo" class="link">Source</a> <a href="#v:reportInfo" class="selflink">#</a></p><div class="doc"><p>Report some general information.</p></div></div><h1 id="g:2">Exception handling</h1><div class="top"><p class="src"><a id="v:reportOrLog" class="def">reportOrLog</a> :: <span class="keyword">forall</span> ctx m. <a href="Pos-Reporting-Methods.html#t:MonadReporting">MonadReporting</a> ctx m =&gt; Severity -&gt; Text -&gt; <a href="../base-4.9.1.0/Control-Exception-Base.html#t:SomeException">SomeException</a> -&gt; m () <a href="src/Pos.Reporting.Methods.html#reportOrLog" class="link">Source</a> <a href="#v:reportOrLog" class="selflink">#</a></p><div class="doc"><p>Exception handler which reports (and logs) an exception or just
 logs it. It reports only few types of exceptions which definitely
 deserve attention. Other types are simply logged. It's suitable for
 long-running workers which want to catch all exceptions and restart
 after delay. If you are catching all exceptions somewhere, you most
 likely want to use this handler (and maybe do something else).</p><p>NOTE: it doesn't rethrow an exception. If you are sure you need it,
 you can rethrow it by yourself.</p></div></div><div class="top"><p class="src"><a id="v:reportOrLogE" class="def">reportOrLogE</a> :: <span class="keyword">forall</span> ctx m. <a href="Pos-Reporting-Methods.html#t:MonadReporting">MonadReporting</a> ctx m =&gt; Text -&gt; <a href="../base-4.9.1.0/Control-Exception-Base.html#t:SomeException">SomeException</a> -&gt; m () <a href="src/Pos.Reporting.Methods.html#reportOrLogE" class="link">Source</a> <a href="#v:reportOrLogE" class="selflink">#</a></p><div class="doc"><p>A version of <code><a href="Pos-Reporting-Methods.html#v:reportOrLog">reportOrLog</a></code> which uses <code>Error</code> severity.</p></div></div><div class="top"><p class="src"><a id="v:reportOrLogW" class="def">reportOrLogW</a> :: <span class="keyword">forall</span> ctx m. <a href="Pos-Reporting-Methods.html#t:MonadReporting">MonadReporting</a> ctx m =&gt; Text -&gt; <a href="../base-4.9.1.0/Control-Exception-Base.html#t:SomeException">SomeException</a> -&gt; m () <a href="src/Pos.Reporting.Methods.html#reportOrLogW" class="link">Source</a> <a href="#v:reportOrLogW" class="selflink">#</a></p><div class="doc"><p>A version of <code><a href="Pos-Reporting-Methods.html#v:reportOrLog">reportOrLog</a></code> which uses <code>Warning</code> severity.</p></div></div><h1 id="g:3">Internals, exported for custom usages.</h1><div class="top"><p class="src"><a id="v:sendReport" class="def">sendReport</a> <a href="src/Pos.Reporting.Methods.html#sendReport" class="link">Source</a> <a href="#v:sendReport" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="../cardano-sl-core-1.0.3/Pos-Core-Configuration.html#t:HasConfiguration">HasConfiguration</a>, <a href="../base-4.9.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m, MonadMask m)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; [<a href="../base-4.9.1.0/System-IO.html#t:FilePath">FilePath</a>]</td><td class="doc"><p>Log files to read from</p></td></tr><tr><td class="src">-&gt; [Text]</td><td class="doc"><p>Raw log text (optional)</p></td></tr><tr><td class="src">-&gt; ReportType</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; Text</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="../base-4.9.1.0/Data-String.html#t:String">String</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; m ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Given logs files list and report type, sends reports to URI
 asked. All files <strong>must</strong> exist. Report server URI should be in form
 like &quot;http(s):/<em>host:port</em>&quot; without specified endpoint.</p><p><strong>Important notice</strong>: if given paths are logs that we're currently
 writing to using this executable (or forked thread), you'll get an
 error, because there's no possibility to have two handles on the
 same file, see <code><a href="System.html#v:IO">IO</a></code> documentation on handles. Use second
 parameter for that.</p></div></div><div class="top"><p class="src"><a id="v:retrieveLogFiles" class="def">retrieveLogFiles</a> :: LoggerConfig -&gt; [([Text], <a href="../base-4.9.1.0/System-IO.html#t:FilePath">FilePath</a>)] <a href="src/Pos.Reporting.Methods.html#retrieveLogFiles" class="link">Source</a> <a href="#v:retrieveLogFiles" class="selflink">#</a></p><div class="doc"><p>Given logger config, retrieves all (logger name, filepath) for
 every logger that has file handle. Filepath inside does <strong>not</strong>
 contain the common logger config prefix.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.3</p></div></body></html>