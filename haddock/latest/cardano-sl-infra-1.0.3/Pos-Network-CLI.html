<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Pos.Network.CLI</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Pos-Network-CLI.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Pos.Network.CLI.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">cardano-sl-infra-1.0.3: Cardano SL - infrastructural</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Pos.Network.CLI</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Exported primilary for testing</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Command line interface for specifying the network config</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span> <a href="#t:NetworkConfigOpts">NetworkConfigOpts</a> = <a href="#v:NetworkConfigOpts">NetworkConfigOpts</a> {<ul class="subs"><li><a href="#v:networkConfigOptsTopology">networkConfigOptsTopology</a> :: <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.9.1.0/System-IO.html#t:FilePath">FilePath</a></li><li><a href="#v:networkConfigOptsKademlia">networkConfigOptsKademlia</a> :: <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.9.1.0/System-IO.html#t:FilePath">FilePath</a></li><li><a href="#v:networkConfigOptsSelf">networkConfigOptsSelf</a> :: <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Pos-Network-Types.html#t:NodeName">NodeName</a></li><li><a href="#v:networkConfigOptsPort">networkConfigOptsPort</a> :: <a href="../base-4.9.1.0/Data-Word.html#t:Word16">Word16</a></li><li><a href="#v:networkConfigOptsPolicies">networkConfigOptsPolicies</a> :: <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.9.1.0/System-IO.html#t:FilePath">FilePath</a></li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:NetworkConfigException">NetworkConfigException</a><ul class="subs"><li>= <a href="#v:CannotParseNetworkConfig">CannotParseNetworkConfig</a> ParseException</li><li>| <a href="#v:MissingKademliaConfig">MissingKademliaConfig</a></li><li>| <a href="#v:CannotParseKademliaConfig">CannotParseKademliaConfig</a> (<a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> <a href="Pos-DHT-Real-Param.html#t:MalformedDHTKey">MalformedDHTKey</a> ParseException)</li><li>| <a href="#v:CannotParsePolicies">CannotParsePolicies</a> ParseException</li><li>| <a href="#v:NetworkConfigSelfUnknown">NetworkConfigSelfUnknown</a></li><li>| <a href="#v:NetworkConfigSelfEdge">NetworkConfigSelfEdge</a></li><li>| <a href="#v:UndefinedNodeName">UndefinedNodeName</a> <a href="Pos-Network-Types.html#t:NodeName">NodeName</a></li><li>| <a href="#v:EmptyListOfAltsFor">EmptyListOfAltsFor</a> <a href="Pos-Network-Types.html#t:NodeName">NodeName</a></li><li>| <a href="#v:NetworkConfigDnsError">NetworkConfigDnsError</a> Domain DNSError</li><li>| <a href="#v:CannotResolve">CannotResolve</a> <a href="Pos-Network-Types.html#t:NodeName">NodeName</a></li><li>| <a href="#v:NoUniqueResolution">NoUniqueResolution</a> <a href="Pos-Network-Types.html#t:NodeName">NodeName</a> [IPv4]</li></ul></li><li class="src short"><a href="#v:networkConfigOption">networkConfigOption</a> :: Parser <a href="Pos-Network-CLI.html#t:NetworkConfigOpts">NetworkConfigOpts</a></li><li class="src short"><a href="#v:ipv4ToNetworkAddress">ipv4ToNetworkAddress</a> :: IPv4 -&gt; <a href="../base-4.9.1.0/Data-Word.html#t:Word16">Word16</a> -&gt; <a href="Pos-Util-TimeWarp.html#t:NetworkAddress">NetworkAddress</a></li><li class="src short"><a href="#v:intNetworkConfigOpts">intNetworkConfigOpts</a> :: <span class="keyword">forall</span> m. (WithLogger m, <a href="../base-4.9.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m, Mockable Fork m, Mockable Catch m, Mockable Throw m) =&gt; <a href="Pos-Network-CLI.html#t:NetworkConfigOpts">NetworkConfigOpts</a> -&gt; m (<a href="Pos-Network-Types.html#t:NetworkConfig">NetworkConfig</a> <a href="Pos-DHT-Real-Param.html#t:KademliaParams">KademliaParams</a>)</li><li class="src short"><a href="#v:readTopology">readTopology</a> :: <a href="../base-4.9.1.0/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="../base-4.9.1.0/System-IO.html#t:IO">IO</a> <a href="Pos-Network-Yaml.html#t:Topology">Topology</a></li><li class="src short"><a href="#v:readPolicies">readPolicies</a> :: <a href="../base-4.9.1.0/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="../base-4.9.1.0/System-IO.html#t:IO">IO</a> <a href="Pos-Network-Yaml.html#t:StaticPolicies">StaticPolicies</a></li><li class="src short"><a href="#v:fromPovOf">fromPovOf</a> :: <a href="Pos-Network-CLI.html#t:NetworkConfigOpts">NetworkConfigOpts</a> -&gt; <a href="Pos-Network-Yaml.html#t:AllStaticallyKnownPeers">AllStaticallyKnownPeers</a> -&gt; <a href="../base-4.9.1.0/System-IO.html#t:IO">IO</a> (<a href="Pos-Network-Yaml.html#t:NodeMetadata">NodeMetadata</a>, Peers <a href="Pos-Network-Types.html#t:NodeId">NodeId</a>, [<a href="Pos-Network-Yaml.html#t:KademliaAddress">KademliaAddress</a>])</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:NetworkConfigOpts" class="def">NetworkConfigOpts</a> <a href="src/Pos.Network.CLI.html#NetworkConfigOpts" class="link">Source</a> <a href="#t:NetworkConfigOpts" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:NetworkConfigOpts" class="def">NetworkConfigOpts</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:networkConfigOptsTopology" class="def">networkConfigOptsTopology</a> :: <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.9.1.0/System-IO.html#t:FilePath">FilePath</a></dfn><div class="doc"><p>Filepath to .yaml file with the network topology</p></div></li><li><dfn class="src"><a id="v:networkConfigOptsKademlia" class="def">networkConfigOptsKademlia</a> :: <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.9.1.0/System-IO.html#t:FilePath">FilePath</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:networkConfigOptsSelf" class="def">networkConfigOptsSelf</a> :: <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Pos-Network-Types.html#t:NodeName">NodeName</a></dfn><div class="doc"><p>Name of the current node</p></div></li><li><dfn class="src"><a id="v:networkConfigOptsPort" class="def">networkConfigOptsPort</a> :: <a href="../base-4.9.1.0/Data-Word.html#t:Word16">Word16</a></dfn><div class="doc"><p>Port number to use when translating IP addresses to NodeIds</p></div></li><li><dfn class="src"><a id="v:networkConfigOptsPolicies" class="def">networkConfigOptsPolicies</a> :: <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.9.1.0/System-IO.html#t:FilePath">FilePath</a></dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div><div class="subs instances"><p id="control.i:NetworkConfigOpts" class="caption collapser" onclick="toggleSection('i:NetworkConfigOpts')">Instances</p><div id="section.i:NetworkConfigOpts" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:NetworkConfigOpts:Show:1" class="instance expander" onclick="toggleSection('i:id:NetworkConfigOpts:Show:1')"></span> <a href="../base-4.9.1.0/Text-Show.html#t:Show">Show</a> <a href="Pos-Network-CLI.html#t:NetworkConfigOpts">NetworkConfigOpts</a></span> <a href="src/Pos.Network.CLI.html#line-71" class="link">Source</a> <a href="#t:NetworkConfigOpts" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:NetworkConfigOpts:Show:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.9.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Pos-Network-CLI.html#t:NetworkConfigOpts">NetworkConfigOpts</a> -&gt; <a href="../base-4.9.1.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Pos-Network-CLI.html#t:NetworkConfigOpts">NetworkConfigOpts</a> -&gt; <a href="../base-4.9.1.0/Data-String.html#t:String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Pos-Network-CLI.html#t:NetworkConfigOpts">NetworkConfigOpts</a>] -&gt; <a href="../base-4.9.1.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:NetworkConfigException" class="def">NetworkConfigException</a> <a href="src/Pos.Network.CLI.html#NetworkConfigException" class="link">Source</a> <a href="#t:NetworkConfigException" class="selflink">#</a></p><div class="doc"><p>Something is wrong with the network configuration</p><p>NOTE: Behind NAT nodes are not given an explicit network configuration file,
 but instead rely on the default topology. These exceptions should never be
 thrown for behind NAT nodes, as we don't want to prevent the user application
 from starting up.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:CannotParseNetworkConfig" class="def">CannotParseNetworkConfig</a> ParseException</td><td class="doc"><p>We cannot parse the topology .yaml file</p></td></tr><tr><td class="src"><a id="v:MissingKademliaConfig" class="def">MissingKademliaConfig</a></td><td class="doc"><p>A Kademlia configuration file is expected but was not specified.</p></td></tr><tr><td class="src"><a id="v:CannotParseKademliaConfig" class="def">CannotParseKademliaConfig</a> (<a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> <a href="Pos-DHT-Real-Param.html#t:MalformedDHTKey">MalformedDHTKey</a> ParseException)</td><td class="doc"><p>We cannot parse the kademlia .yaml file</p></td></tr><tr><td class="src"><a id="v:CannotParsePolicies" class="def">CannotParsePolicies</a> ParseException</td><td class="doc"><p>A policy description .yaml was specified but couldn't be parsed.</p></td></tr><tr><td class="src"><a id="v:NetworkConfigSelfUnknown" class="def">NetworkConfigSelfUnknown</a></td><td class="doc"><p>We use a set of statically known peers but we weren't given the
 name of the current node</p></td></tr><tr><td class="src"><a id="v:NetworkConfigSelfEdge" class="def">NetworkConfigSelfEdge</a></td><td class="doc"><p>We resolved our name under static configuration to be an edge node.
 This indicates a programmer error.</p></td></tr><tr><td class="src"><a id="v:UndefinedNodeName" class="def">UndefinedNodeName</a> <a href="Pos-Network-Types.html#t:NodeName">NodeName</a></td><td class="doc"><p>The .yaml file contains a node name which is undefined</p></td></tr><tr><td class="src"><a id="v:EmptyListOfAltsFor" class="def">EmptyListOfAltsFor</a> <a href="Pos-Network-Types.html#t:NodeName">NodeName</a></td><td class="doc"><p>The static routes for a node contains an empty list of alternatives</p></td></tr><tr><td class="src"><a id="v:NetworkConfigDnsError" class="def">NetworkConfigDnsError</a> Domain DNSError</td><td class="doc"><p>Something went wrong during node name resolution</p></td></tr><tr><td class="src"><a id="v:CannotResolve" class="def">CannotResolve</a> <a href="Pos-Network-Types.html#t:NodeName">NodeName</a></td><td class="doc"><p>Could not resolve a node name to an IP address</p></td></tr><tr><td class="src"><a id="v:NoUniqueResolution" class="def">NoUniqueResolution</a> <a href="Pos-Network-Types.html#t:NodeName">NodeName</a> [IPv4]</td><td class="doc"><p>DNS returned multiple IP addresses for the give node name</p><p>This is no good because we need canonical node IDs.</p></td></tr></table></div><div class="subs instances"><p id="control.i:NetworkConfigException" class="caption collapser" onclick="toggleSection('i:NetworkConfigException')">Instances</p><div id="section.i:NetworkConfigException" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:NetworkConfigException:Show:1" class="instance expander" onclick="toggleSection('i:id:NetworkConfigException:Show:1')"></span> <a href="../base-4.9.1.0/Text-Show.html#t:Show">Show</a> <a href="Pos-Network-CLI.html#t:NetworkConfigException">NetworkConfigException</a></span> <a href="src/Pos.Network.CLI.html#line-504" class="link">Source</a> <a href="#t:NetworkConfigException" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:NetworkConfigException:Show:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.9.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Pos-Network-CLI.html#t:NetworkConfigException">NetworkConfigException</a> -&gt; <a href="../base-4.9.1.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Pos-Network-CLI.html#t:NetworkConfigException">NetworkConfigException</a> -&gt; <a href="../base-4.9.1.0/Data-String.html#t:String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Pos-Network-CLI.html#t:NetworkConfigException">NetworkConfigException</a>] -&gt; <a href="../base-4.9.1.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:NetworkConfigException:Exception:2" class="instance expander" onclick="toggleSection('i:id:NetworkConfigException:Exception:2')"></span> <a href="../base-4.9.1.0/Control-Exception-Base.html#t:Exception">Exception</a> <a href="Pos-Network-CLI.html#t:NetworkConfigException">NetworkConfigException</a></span> <a href="src/Pos.Network.CLI.html#line-506" class="link">Source</a> <a href="#t:NetworkConfigException" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:NetworkConfigException:Exception:2" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:toException">toException</a> :: <a href="Pos-Network-CLI.html#t:NetworkConfigException">NetworkConfigException</a> -&gt; <a href="../base-4.9.1.0/Control-Exception-Base.html#t:SomeException">SomeException</a> <a href="#v:toException" class="selflink">#</a></p><p class="src"><a href="#v:fromException">fromException</a> :: <a href="../base-4.9.1.0/Control-Exception-Base.html#t:SomeException">SomeException</a> -&gt; <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Pos-Network-CLI.html#t:NetworkConfigException">NetworkConfigException</a> <a href="#v:fromException" class="selflink">#</a></p><p class="src"><a href="#v:displayException">displayException</a> :: <a href="Pos-Network-CLI.html#t:NetworkConfigException">NetworkConfigException</a> -&gt; <a href="../base-4.9.1.0/Data-String.html#t:String">String</a> <a href="#v:displayException" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><a id="v:networkConfigOption" class="def">networkConfigOption</a> :: Parser <a href="Pos-Network-CLI.html#t:NetworkConfigOpts">NetworkConfigOpts</a> <a href="src/Pos.Network.CLI.html#networkConfigOption" class="link">Source</a> <a href="#v:networkConfigOption" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:ipv4ToNetworkAddress" class="def">ipv4ToNetworkAddress</a> :: IPv4 -&gt; <a href="../base-4.9.1.0/Data-Word.html#t:Word16">Word16</a> -&gt; <a href="Pos-Util-TimeWarp.html#t:NetworkAddress">NetworkAddress</a> <a href="src/Pos.Network.CLI.html#ipv4ToNetworkAddress" class="link">Source</a> <a href="#v:ipv4ToNetworkAddress" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:intNetworkConfigOpts" class="def">intNetworkConfigOpts</a> :: <span class="keyword">forall</span> m. (WithLogger m, <a href="../base-4.9.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m, Mockable Fork m, Mockable Catch m, Mockable Throw m) =&gt; <a href="Pos-Network-CLI.html#t:NetworkConfigOpts">NetworkConfigOpts</a> -&gt; m (<a href="Pos-Network-Types.html#t:NetworkConfig">NetworkConfig</a> <a href="Pos-DHT-Real-Param.html#t:KademliaParams">KademliaParams</a>) <a href="src/Pos.Network.CLI.html#intNetworkConfigOpts" class="link">Source</a> <a href="#v:intNetworkConfigOpts" class="selflink">#</a></p><div class="doc"><p>Interpreter for the network config opts</p></div></div><h1 id="g:1">Exported primilary for testing</h1><div class="top"><p class="src"><a id="v:readTopology" class="def">readTopology</a> :: <a href="../base-4.9.1.0/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="../base-4.9.1.0/System-IO.html#t:IO">IO</a> <a href="Pos-Network-Yaml.html#t:Topology">Topology</a> <a href="src/Pos.Network.CLI.html#readTopology" class="link">Source</a> <a href="#v:readTopology" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:readPolicies" class="def">readPolicies</a> :: <a href="../base-4.9.1.0/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="../base-4.9.1.0/System-IO.html#t:IO">IO</a> <a href="Pos-Network-Yaml.html#t:StaticPolicies">StaticPolicies</a> <a href="src/Pos.Network.CLI.html#readPolicies" class="link">Source</a> <a href="#v:readPolicies" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:fromPovOf" class="def">fromPovOf</a> :: <a href="Pos-Network-CLI.html#t:NetworkConfigOpts">NetworkConfigOpts</a> -&gt; <a href="Pos-Network-Yaml.html#t:AllStaticallyKnownPeers">AllStaticallyKnownPeers</a> -&gt; <a href="../base-4.9.1.0/System-IO.html#t:IO">IO</a> (<a href="Pos-Network-Yaml.html#t:NodeMetadata">NodeMetadata</a>, Peers <a href="Pos-Network-Types.html#t:NodeId">NodeId</a>, [<a href="Pos-Network-Yaml.html#t:KademliaAddress">KademliaAddress</a>]) <a href="src/Pos.Network.CLI.html#fromPovOf" class="link">Source</a> <a href="#v:fromPovOf" class="selflink">#</a></p><div class="doc"><p>Perspective on <code>AllStaticallyKnownPeers</code> from the point of view of
 a single node.</p><p>First component is this node's metadata.
 Second component is the set of all known peers (routes included).
 Third component is the set of addresses of peers running kademlia.
   If this node runs kademlia, its address will appear as the last entry in
   the list.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.3</p></div></body></html>