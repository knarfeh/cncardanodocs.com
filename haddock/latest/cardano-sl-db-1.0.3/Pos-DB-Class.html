<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Pos.DB.Class</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Pos-DB-Class.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Pos.DB.Class.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">cardano-sl-db-1.0.3: Cardano SL - basic DB interfaces</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Pos.DB.Class</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Pure</a></li><li><a href="#g:2">GState</a></li><li><a href="#g:3">Block DB</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>A set of type classes which provide access to database.</p><p><code><a href="Pos-DB-Class.html#t:MonadDBRead">MonadDBRead</a></code> contains reading and iterating capabilities. The
 advantage of it is that you don't need to do any <code><a href="../base-4.9.1.0/System-IO.html#t:IO">IO</a></code> to use it
 which makes it suitable for pure testing.</p><p><code><a href="Pos-DB-Class.html#t:MonadDB">MonadDB</a></code> is a superclass of <code><a href="Pos-DB-Class.html#t:MonadDB">MonadDB</a></code> and allows to modify
 DB. Again, its purpose is to make it possible to use DB w/o IO
 context.</p><p><code><a href="Pos-DB-Class.html#t:MonadGState">MonadGState</a></code> contains functions to retrieve some data from
 GState DB without knowledge of where this data is located (where in
 code and where in DB, i. e. by which key). For example, if X wants
 to get data maintained by Y and doesn't know about Y, it can use
 <code><a href="Pos-DB-Class.html#t:MonadGState">MonadGState</a></code> (which is at pretty low level).</p><p>Described two classes have RocksDB implementation <a href="DB-Rocks.html">DB.Rocks</a> and
 pure one for testing <a href="DB-Pure.html">DB.Pure</a>.</p><p><code><a href="Pos-DB-Class.html#t:MonadBlockDBGeneric">MonadBlockDBGeneric</a></code> contains functions which provide read-only
 access to the Block DB.
 For this DB we don't want to use <code>MonadRealDB</code> for several reasons:
 &#8226; we store blocks and undos in files, not in key-value storage;
 &#8226; there are only three getters, so it's not a big problem to make all of
 them part of type class;
 &#8226; some parts of code need to access Block DB but they don't know actual
 type of <code>Block</code> and/or <code>BlockHeader</code> as well as <code>Undo</code>, so <code>MonadBlockDB</code>
 is parameterized by these types.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span> <a href="#t:DBTag">DBTag</a><ul class="subs"><li>= <a href="#v:BlockIndexDB">BlockIndexDB</a></li><li>| <a href="#v:GStateDB">GStateDB</a></li><li>| <a href="#v:LrcDB">LrcDB</a></li><li>| <a href="#v:MiscDB">MiscDB</a></li></ul></li><li class="src short"><span class="keyword">class</span> <a href="#t:DBIteratorClass">DBIteratorClass</a> i <span class="keyword">where</span><ul class="subs"><li><span class="keyword">type</span> <a href="#t:IterKey">IterKey</a> i :: <a href="../base-4.9.1.0/Data-Kind.html#t:-42-">*</a></li><li><span class="keyword">type</span> <a href="#t:IterValue">IterValue</a> i :: <a href="../base-4.9.1.0/Data-Kind.html#t:-42-">*</a></li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:IterType">IterType</a> i = (<a href="Pos-DB-Class.html#t:IterKey">IterKey</a> i, <a href="Pos-DB-Class.html#t:IterValue">IterValue</a> i)</li><li class="src short"><span class="keyword">class</span> (<a href="../cardano-sl-core-1.0.3/Pos-Core-Configuration.html#t:HasConfiguration">HasConfiguration</a>, MonadBaseControl <a href="../base-4.9.1.0/System-IO.html#t:IO">IO</a> m, MonadThrow m) =&gt; <a href="#t:MonadDBRead">MonadDBRead</a> m <span class="keyword">where</span><ul class="subs"></ul></li><li class="src short"><span class="keyword">class</span> <a href="Pos-DB-Class.html#t:MonadDBRead">MonadDBRead</a> m =&gt; <a href="#t:MonadDB">MonadDB</a> m <span class="keyword">where</span><ul class="subs"></ul></li><li class="src short"><span class="keyword">class</span> <a href="../base-4.9.1.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="#t:MonadGState">MonadGState</a> m <span class="keyword">where</span><ul class="subs"></ul></li><li class="src short"><a href="#v:gsMaxBlockSize">gsMaxBlockSize</a> :: <a href="Pos-DB-Class.html#t:MonadGState">MonadGState</a> m =&gt; m Byte</li><li class="src short"><a href="#v:gsMaxHeaderSize">gsMaxHeaderSize</a> :: <a href="Pos-DB-Class.html#t:MonadGState">MonadGState</a> m =&gt; m Byte</li><li class="src short"><a href="#v:gsMaxTxSize">gsMaxTxSize</a> :: <a href="Pos-DB-Class.html#t:MonadGState">MonadGState</a> m =&gt; m Byte</li><li class="src short"><a href="#v:gsMaxProposalSize">gsMaxProposalSize</a> :: <a href="Pos-DB-Class.html#t:MonadGState">MonadGState</a> m =&gt; m Byte</li><li class="src short"><a href="#v:gsUnlockStakeEpoch">gsUnlockStakeEpoch</a> :: <a href="Pos-DB-Class.html#t:MonadGState">MonadGState</a> m =&gt; m <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:EpochIndex">EpochIndex</a></li><li class="src short"><a href="#v:gsIsBootstrapEra">gsIsBootstrapEra</a> :: <a href="Pos-DB-Class.html#t:MonadGState">MonadGState</a> m =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:EpochIndex">EpochIndex</a> -&gt; m <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><span class="keyword">class</span> <a href="Pos-DB-Class.html#t:MonadDBRead">MonadDBRead</a> m =&gt; <a href="#t:MonadBlockDBGeneric">MonadBlockDBGeneric</a> header blk undo m | blk -&gt; header, blk -&gt; undo <span class="keyword">where</span><ul class="subs"></ul></li><li class="src short"><a href="#v:dbGetBlund">dbGetBlund</a> :: <span class="keyword">forall</span> header blk undo m. <a href="Pos-DB-Class.html#t:MonadBlockDBGeneric">MonadBlockDBGeneric</a> header blk undo m =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:HeaderHash">HeaderHash</a> -&gt; m $ <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> (blk, undo)</li><li class="src short"><span class="keyword">class</span> <a href="Pos-DB-Class.html#t:MonadBlockDBGeneric">MonadBlockDBGeneric</a> header blk undo m =&gt; <a href="#t:MonadBlockDBGenericWrite">MonadBlockDBGenericWrite</a> header blk undo m <span class="keyword">where</span><ul class="subs"></ul></li></ul></div><div id="interface"><h1 id="g:1">Pure</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:DBTag" class="def">DBTag</a> <a href="src/Pos.DB.Class.html#DBTag" class="link">Source</a> <a href="#t:DBTag" class="selflink">#</a></p><div class="doc"><p>Tag which denotes one of DBs used by application.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:BlockIndexDB" class="def">BlockIndexDB</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:GStateDB" class="def">GStateDB</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:LrcDB" class="def">LrcDB</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:MiscDB" class="def">MiscDB</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:DBTag" class="caption collapser" onclick="toggleSection('i:DBTag')">Instances</p><div id="section.i:DBTag" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:DBTag:Eq:1" class="instance expander" onclick="toggleSection('i:id:DBTag:Eq:1')"></span> <a href="../base-4.9.1.0/Data-Eq.html#t:Eq">Eq</a> <a href="Pos-DB-Class.html#t:DBTag">DBTag</a></span> <a href="src/Pos.DB.Class.html#line-84" class="link">Source</a> <a href="#t:DBTag" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:DBTag:Eq:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Pos-DB-Class.html#t:DBTag">DBTag</a> -&gt; <a href="Pos-DB-Class.html#t:DBTag">DBTag</a> -&gt; <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Pos-DB-Class.html#t:DBTag">DBTag</a> -&gt; <a href="Pos-DB-Class.html#t:DBTag">DBTag</a> -&gt; <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">class</span> <a id="t:DBIteratorClass" class="def">DBIteratorClass</a> i <span class="keyword">where</span> <a href="src/Pos.DB.Class.html#DBIteratorClass" class="link">Source</a> <a href="#t:DBIteratorClass" class="selflink">#</a></p><div class="doc"><p>Key-value type family encapsulating the iterator (something we
 can iterate on) functionality.</p></div><div class="subs minimal"><p class="caption">Minimal complete definition</p><p class="src"><a href="Pos-DB-Class.html#v:iterKeyPrefix">iterKeyPrefix</a></p></div><div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a id="t:IterKey" class="def">IterKey</a> i :: <a href="../base-4.9.1.0/Data-Kind.html#t:-42-">*</a> <a href="src/Pos.DB.Class.html#IterKey" class="link">Source</a> <a href="#t:IterKey" class="selflink">#</a></p><p class="src"><span class="keyword">type</span> <a id="t:IterValue" class="def">IterValue</a> i :: <a href="../base-4.9.1.0/Data-Kind.html#t:-42-">*</a> <a href="src/Pos.DB.Class.html#IterValue" class="link">Source</a> <a href="#t:IterValue" class="selflink">#</a></p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:iterKeyPrefix" class="def">iterKeyPrefix</a> :: <a href="../bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a> <a href="src/Pos.DB.Class.html#iterKeyPrefix" class="link">Source</a> <a href="#v:iterKeyPrefix" class="selflink">#</a></p></div><div class="subs instances"><p id="control.i:DBIteratorClass" class="caption collapser" onclick="toggleSection('i:DBIteratorClass')">Instances</p><div id="section.i:DBIteratorClass" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:DBIteratorClass:DBIteratorClass:1" class="instance expander" onclick="toggleSection('i:ic:DBIteratorClass:DBIteratorClass:1')"></span> <a href="Pos-DB-Class.html#t:DBIteratorClass">DBIteratorClass</a> <a href="Pos-DB-GState-Stakes.html#t:StakeIter">StakeIter</a></span> <a href="src/Pos.DB.Class.html#line-30" class="link">Source</a> <a href="#t:DBIteratorClass" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:ic:DBIteratorClass:DBIteratorClass:1" class="inst-details hide"><div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="Pos-DB-Class.html#t:IterKey">IterKey</a> <a href="Pos-DB-GState-Stakes.html#t:StakeIter">StakeIter</a> :: <a href="../base-4.9.1.0/Data-Kind.html#t:-42-">*</a> <a href="src/Pos.DB.Class.html#IterKey" class="link">Source</a> <a href="#t:IterKey" class="selflink">#</a></p><p class="src"><span class="keyword">type</span> <a href="Pos-DB-Class.html#t:IterValue">IterValue</a> <a href="Pos-DB-GState-Stakes.html#t:StakeIter">StakeIter</a> :: <a href="../base-4.9.1.0/Data-Kind.html#t:-42-">*</a> <a href="src/Pos.DB.Class.html#IterValue" class="link">Source</a> <a href="#t:IterValue" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:iterKeyPrefix">iterKeyPrefix</a> :: <a href="../bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a> <a href="src/Pos.DB.Class.html#iterKeyPrefix" class="link">Source</a> <a href="#v:iterKeyPrefix" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:IterType" class="def">IterType</a> i = (<a href="Pos-DB-Class.html#t:IterKey">IterKey</a> i, <a href="Pos-DB-Class.html#t:IterValue">IterValue</a> i) <a href="src/Pos.DB.Class.html#IterType" class="link">Source</a> <a href="#t:IterType" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">class</span> (<a href="../cardano-sl-core-1.0.3/Pos-Core-Configuration.html#t:HasConfiguration">HasConfiguration</a>, MonadBaseControl <a href="../base-4.9.1.0/System-IO.html#t:IO">IO</a> m, MonadThrow m) =&gt; <a id="t:MonadDBRead" class="def">MonadDBRead</a> m <span class="keyword">where</span> <a href="src/Pos.DB.Class.html#MonadDBRead" class="link">Source</a> <a href="#t:MonadDBRead" class="selflink">#</a></p><div class="doc"><p>Pure read-only interface to the database.</p></div><div class="subs minimal"><p class="caption">Minimal complete definition</p><p class="src"><a href="Pos-DB-Class.html#v:dbGet">dbGet</a>, <a href="Pos-DB-Class.html#v:dbIterSource">dbIterSource</a></p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:dbGet" class="def">dbGet</a> :: <a href="Pos-DB-Class.html#t:DBTag">DBTag</a> -&gt; <a href="../bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; m (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a>) <a href="src/Pos.DB.Class.html#dbGet" class="link">Source</a> <a href="#v:dbGet" class="selflink">#</a></p><div class="doc"><p>This function takes tag and key and reads value associated
 with given key from DB corresponding to given tag.</p></div><p class="src"><a id="v:dbIterSource" class="def">dbIterSource</a> :: (<a href="Pos-DB-Class.html#t:DBIteratorClass">DBIteratorClass</a> i, <a href="../cardano-sl-core-1.0.3/Pos-Binary-Class-Core.html#t:Bi">Bi</a> (<a href="Pos-DB-Class.html#t:IterKey">IterKey</a> i), <a href="../cardano-sl-core-1.0.3/Pos-Binary-Class-Core.html#t:Bi">Bi</a> (<a href="Pos-DB-Class.html#t:IterValue">IterValue</a> i)) =&gt; <a href="Pos-DB-Class.html#t:DBTag">DBTag</a> -&gt; <a href="../base-4.9.1.0/Data-Proxy.html#t:Proxy">Proxy</a> i -&gt; Source (ResourceT m) (<a href="Pos-DB-Class.html#t:IterType">IterType</a> i) <a href="src/Pos.DB.Class.html#dbIterSource" class="link">Source</a> <a href="#v:dbIterSource" class="selflink">#</a></p><div class="doc"><p>Source producing iteration over given <code>i</code>.</p></div></div><div class="subs instances"><p id="control.i:MonadDBRead" class="caption collapser" onclick="toggleSection('i:MonadDBRead')">Instances</p><div id="section.i:MonadDBRead" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:MonadDBRead:MonadDBRead:1" class="instance expander" onclick="toggleSection('i:ic:MonadDBRead:MonadDBRead:1')"></span> (<a href="Pos-DB-Class.html#t:MonadDBRead">MonadDBRead</a> m, MonadTrans t, MonadThrow (t m), MonadBaseControl <a href="../base-4.9.1.0/System-IO.html#t:IO">IO</a> (t m)) =&gt; <a href="Pos-DB-Class.html#t:MonadDBRead">MonadDBRead</a> (t m)</span> <a href="src/Pos.DB.Class.html#line-109" class="link">Source</a> <a href="#t:MonadDBRead" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:ic:MonadDBRead:MonadDBRead:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:dbGet">dbGet</a> :: <a href="Pos-DB-Class.html#t:DBTag">DBTag</a> -&gt; <a href="../bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; t m (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a>) <a href="src/Pos.DB.Class.html#dbGet" class="link">Source</a> <a href="#v:dbGet" class="selflink">#</a></p><p class="src"><a href="#v:dbIterSource">dbIterSource</a> :: (<a href="Pos-DB-Class.html#t:DBIteratorClass">DBIteratorClass</a> i, <a href="../cardano-sl-core-1.0.3/Pos-Binary-Class-Core.html#t:Bi">Bi</a> (<a href="Pos-DB-Class.html#t:IterKey">IterKey</a> i), <a href="../cardano-sl-core-1.0.3/Pos-Binary-Class-Core.html#t:Bi">Bi</a> (<a href="Pos-DB-Class.html#t:IterValue">IterValue</a> i)) =&gt; <a href="Pos-DB-Class.html#t:DBTag">DBTag</a> -&gt; <a href="../base-4.9.1.0/Data-Proxy.html#t:Proxy">Proxy</a> <a href="../base-4.9.1.0/Data-Kind.html#t:-42-">*</a> i -&gt; Source (ResourceT (t m)) (<a href="Pos-DB-Class.html#t:IterType">IterType</a> i) <a href="src/Pos.DB.Class.html#dbIterSource" class="link">Source</a> <a href="#v:dbIterSource" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">class</span> <a href="Pos-DB-Class.html#t:MonadDBRead">MonadDBRead</a> m =&gt; <a id="t:MonadDB" class="def">MonadDB</a> m <span class="keyword">where</span> <a href="src/Pos.DB.Class.html#MonadDB" class="link">Source</a> <a href="#t:MonadDB" class="selflink">#</a></p><div class="doc"><p>Pure interface to the database. Combines read-only interface and
 ability to put raw bytes.</p></div><div class="subs minimal"><p class="caption">Minimal complete definition</p><p class="src"><a href="Pos-DB-Class.html#v:dbPut">dbPut</a>, <a href="Pos-DB-Class.html#v:dbWriteBatch">dbWriteBatch</a>, <a href="Pos-DB-Class.html#v:dbDelete">dbDelete</a></p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:dbPut" class="def">dbPut</a> :: <a href="Pos-DB-Class.html#t:DBTag">DBTag</a> -&gt; <a href="../bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="../bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; m () <a href="src/Pos.DB.Class.html#dbPut" class="link">Source</a> <a href="#v:dbPut" class="selflink">#</a></p><div class="doc"><p>This function takes tag, key and value and puts given value
 associated with given key into DB corresponding to given tag.</p></div><p class="src"><a id="v:dbWriteBatch" class="def">dbWriteBatch</a> :: <a href="Pos-DB-Class.html#t:DBTag">DBTag</a> -&gt; [BatchOp] -&gt; m () <a href="src/Pos.DB.Class.html#dbWriteBatch" class="link">Source</a> <a href="#v:dbWriteBatch" class="selflink">#</a></p><div class="doc"><p>Write batch of operations into DB corresponding to given
 tag. This write is atomic.</p><p>There are multiple candidates for a type representing batch
 operation, for instance:
 &#8226; Rocks.BatchOp is a good candidate because it's exactly what we want
 for pure implementation and it can be used as is for RocksDB.
 &#8226; We could define our own type for this class, but it would be an
 overkill.
 &#8226; <code>SomeBatchOp</code> could also be used, but it seems to be overcomplication
 for such simple interface.</p><p>So a list of <code>BatchOp</code> was chosen.</p></div><p class="src"><a id="v:dbDelete" class="def">dbDelete</a> :: <a href="Pos-DB-Class.html#t:DBTag">DBTag</a> -&gt; <a href="../bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; m () <a href="src/Pos.DB.Class.html#dbDelete" class="link">Source</a> <a href="#v:dbDelete" class="selflink">#</a></p><div class="doc"><p>This function takes tag and key and deletes value associated
 with given key from DB corresponding to given tag.</p></div></div><div class="subs instances"><p id="control.i:MonadDB" class="caption collapser" onclick="toggleSection('i:MonadDB')">Instances</p><div id="section.i:MonadDB" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:MonadDB:MonadDB:1" class="instance expander" onclick="toggleSection('i:ic:MonadDB:MonadDB:1')"></span> (<a href="Pos-DB-Class.html#t:MonadDB">MonadDB</a> m, MonadTrans t, MonadThrow (t m), MonadBaseControl <a href="../base-4.9.1.0/System-IO.html#t:IO">IO</a> (t m)) =&gt; <a href="Pos-DB-Class.html#t:MonadDB">MonadDB</a> (t m)</span> <a href="src/Pos.DB.Class.html#line-144" class="link">Source</a> <a href="#t:MonadDB" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:ic:MonadDB:MonadDB:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:dbPut">dbPut</a> :: <a href="Pos-DB-Class.html#t:DBTag">DBTag</a> -&gt; <a href="../bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="../bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; t m () <a href="src/Pos.DB.Class.html#dbPut" class="link">Source</a> <a href="#v:dbPut" class="selflink">#</a></p><p class="src"><a href="#v:dbWriteBatch">dbWriteBatch</a> :: <a href="Pos-DB-Class.html#t:DBTag">DBTag</a> -&gt; [BatchOp] -&gt; t m () <a href="src/Pos.DB.Class.html#dbWriteBatch" class="link">Source</a> <a href="#v:dbWriteBatch" class="selflink">#</a></p><p class="src"><a href="#v:dbDelete">dbDelete</a> :: <a href="Pos-DB-Class.html#t:DBTag">DBTag</a> -&gt; <a href="../bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; t m () <a href="src/Pos.DB.Class.html#dbDelete" class="link">Source</a> <a href="#v:dbDelete" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><h1 id="g:2">GState</h1><div class="top"><p class="src"><span class="keyword">class</span> <a href="../base-4.9.1.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a id="t:MonadGState" class="def">MonadGState</a> m <span class="keyword">where</span> <a href="src/Pos.DB.Class.html#MonadGState" class="link">Source</a> <a href="#t:MonadGState" class="selflink">#</a></p><div class="doc"><p>This type class provides functions to get core data from GState.
 The idea is that actual getters may be defined at high levels, but
 may be needed at lower levels.</p><p>This class doesn't have a <code>MonadRealDB</code> constraint, because
 alternative DBs my be used to provide this data.</p></div><div class="subs minimal"><p class="caption">Minimal complete definition</p><p class="src"><a href="Pos-DB-Class.html#v:gsAdoptedBVData">gsAdoptedBVData</a></p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:gsAdoptedBVData" class="def">gsAdoptedBVData</a> :: m <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:BlockVersionData">BlockVersionData</a> <a href="src/Pos.DB.Class.html#gsAdoptedBVData" class="link">Source</a> <a href="#v:gsAdoptedBVData" class="selflink">#</a></p></div><div class="subs instances"><p id="control.i:MonadGState" class="caption collapser" onclick="toggleSection('i:MonadGState')">Instances</p><div id="section.i:MonadGState" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:MonadGState:MonadGState:1" class="instance expander" onclick="toggleSection('i:ic:MonadGState:MonadGState:1')"></span> <a href="Pos-DB-Class.html#t:MonadGState">MonadGState</a> ((-&gt;) <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:BlockVersionData">BlockVersionData</a>)</span> <a href="src/Pos.DB.Class.html#line-164" class="link">Source</a> <a href="#t:MonadGState" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:ic:MonadGState:MonadGState:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:gsAdoptedBVData">gsAdoptedBVData</a> :: <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:BlockVersionData">BlockVersionData</a> -&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:BlockVersionData">BlockVersionData</a> <a href="src/Pos.DB.Class.html#gsAdoptedBVData" class="link">Source</a> <a href="#v:gsAdoptedBVData" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:MonadGState:MonadGState:2" class="instance expander" onclick="toggleSection('i:ic:MonadGState:MonadGState:2')"></span> (<a href="Pos-DB-Class.html#t:MonadGState">MonadGState</a> m, MonadTrans t, <a href="../base-4.9.1.0/Control-Monad.html#t:Monad">Monad</a> (t m)) =&gt; <a href="Pos-DB-Class.html#t:MonadGState">MonadGState</a> (t m)</span> <a href="src/Pos.DB.Class.html#line-168" class="link">Source</a> <a href="#t:MonadGState" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:ic:MonadGState:MonadGState:2" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:gsAdoptedBVData">gsAdoptedBVData</a> :: t m <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:BlockVersionData">BlockVersionData</a> <a href="src/Pos.DB.Class.html#gsAdoptedBVData" class="link">Source</a> <a href="#v:gsAdoptedBVData" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><a id="v:gsMaxBlockSize" class="def">gsMaxBlockSize</a> :: <a href="Pos-DB-Class.html#t:MonadGState">MonadGState</a> m =&gt; m Byte <a href="src/Pos.DB.Class.html#gsMaxBlockSize" class="link">Source</a> <a href="#v:gsMaxBlockSize" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:gsMaxHeaderSize" class="def">gsMaxHeaderSize</a> :: <a href="Pos-DB-Class.html#t:MonadGState">MonadGState</a> m =&gt; m Byte <a href="src/Pos.DB.Class.html#gsMaxHeaderSize" class="link">Source</a> <a href="#v:gsMaxHeaderSize" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:gsMaxTxSize" class="def">gsMaxTxSize</a> :: <a href="Pos-DB-Class.html#t:MonadGState">MonadGState</a> m =&gt; m Byte <a href="src/Pos.DB.Class.html#gsMaxTxSize" class="link">Source</a> <a href="#v:gsMaxTxSize" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:gsMaxProposalSize" class="def">gsMaxProposalSize</a> :: <a href="Pos-DB-Class.html#t:MonadGState">MonadGState</a> m =&gt; m Byte <a href="src/Pos.DB.Class.html#gsMaxProposalSize" class="link">Source</a> <a href="#v:gsMaxProposalSize" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:gsUnlockStakeEpoch" class="def">gsUnlockStakeEpoch</a> :: <a href="Pos-DB-Class.html#t:MonadGState">MonadGState</a> m =&gt; m <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:EpochIndex">EpochIndex</a> <a href="src/Pos.DB.Class.html#gsUnlockStakeEpoch" class="link">Source</a> <a href="#v:gsUnlockStakeEpoch" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:gsIsBootstrapEra" class="def">gsIsBootstrapEra</a> :: <a href="Pos-DB-Class.html#t:MonadGState">MonadGState</a> m =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:EpochIndex">EpochIndex</a> -&gt; m <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="src/Pos.DB.Class.html#gsIsBootstrapEra" class="link">Source</a> <a href="#v:gsIsBootstrapEra" class="selflink">#</a></p><div class="doc"><p>Checks if provided epoch is in the bootstrap era.</p></div></div><h1 id="g:3">Block DB</h1><div class="top"><p class="src"><span class="keyword">class</span> <a href="Pos-DB-Class.html#t:MonadDBRead">MonadDBRead</a> m =&gt; <a id="t:MonadBlockDBGeneric" class="def">MonadBlockDBGeneric</a> header blk undo m | blk -&gt; header, blk -&gt; undo <span class="keyword">where</span> <a href="src/Pos.DB.Class.html#MonadBlockDBGeneric" class="link">Source</a> <a href="#t:MonadBlockDBGeneric" class="selflink">#</a></p><div class="doc"><p>Monad which provides read-only access to the Block DB. It's
 generic in a way that it allows to specify different types of
 block|header|undo. Read rationale behind this type in the
 documentation of this module.</p></div><div class="subs minimal"><p class="caption">Minimal complete definition</p><p class="src"><a href="Pos-DB-Class.html#v:dbGetHeader">dbGetHeader</a>, <a href="Pos-DB-Class.html#v:dbGetBlock">dbGetBlock</a>, <a href="Pos-DB-Class.html#v:dbGetUndo">dbGetUndo</a></p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:dbGetHeader" class="def">dbGetHeader</a> :: <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:HeaderHash">HeaderHash</a> -&gt; m (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> header) <a href="src/Pos.DB.Class.html#dbGetHeader" class="link">Source</a> <a href="#v:dbGetHeader" class="selflink">#</a></p><p class="src"><a id="v:dbGetBlock" class="def">dbGetBlock</a> :: <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:HeaderHash">HeaderHash</a> -&gt; m (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> blk) <a href="src/Pos.DB.Class.html#dbGetBlock" class="link">Source</a> <a href="#v:dbGetBlock" class="selflink">#</a></p><p class="src"><a id="v:dbGetUndo" class="def">dbGetUndo</a> :: <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:HeaderHash">HeaderHash</a> -&gt; m (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> undo) <a href="src/Pos.DB.Class.html#dbGetUndo" class="link">Source</a> <a href="#v:dbGetUndo" class="selflink">#</a></p></div><div class="subs instances"><p id="control.i:MonadBlockDBGeneric" class="caption collapser" onclick="toggleSection('i:MonadBlockDBGeneric')">Instances</p><div id="section.i:MonadBlockDBGeneric" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:MonadBlockDBGeneric:MonadBlockDBGeneric:1" class="instance expander" onclick="toggleSection('i:ic:MonadBlockDBGeneric:MonadBlockDBGeneric:1')"></span> (<a href="Pos-DB-Class.html#t:MonadBlockDBGeneric">MonadBlockDBGeneric</a> header blk undo m, MonadTrans t, <a href="Pos-DB-Class.html#t:MonadDBRead">MonadDBRead</a> (t m)) =&gt; <a href="Pos-DB-Class.html#t:MonadBlockDBGeneric">MonadBlockDBGeneric</a> header blk undo (t m)</span> <a href="src/Pos.DB.Class.html#line-210" class="link">Source</a> <a href="#t:MonadBlockDBGeneric" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:ic:MonadBlockDBGeneric:MonadBlockDBGeneric:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:dbGetHeader">dbGetHeader</a> :: <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:HeaderHash">HeaderHash</a> -&gt; t m (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> header) <a href="src/Pos.DB.Class.html#dbGetHeader" class="link">Source</a> <a href="#v:dbGetHeader" class="selflink">#</a></p><p class="src"><a href="#v:dbGetBlock">dbGetBlock</a> :: <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:HeaderHash">HeaderHash</a> -&gt; t m (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> blk) <a href="src/Pos.DB.Class.html#dbGetBlock" class="link">Source</a> <a href="#v:dbGetBlock" class="selflink">#</a></p><p class="src"><a href="#v:dbGetUndo">dbGetUndo</a> :: <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:HeaderHash">HeaderHash</a> -&gt; t m (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> undo) <a href="src/Pos.DB.Class.html#dbGetUndo" class="link">Source</a> <a href="#v:dbGetUndo" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><a id="v:dbGetBlund" class="def">dbGetBlund</a> :: <span class="keyword">forall</span> header blk undo m. <a href="Pos-DB-Class.html#t:MonadBlockDBGeneric">MonadBlockDBGeneric</a> header blk undo m =&gt; <a href="../cardano-sl-core-1.0.3/Pos-Core-Types.html#t:HeaderHash">HeaderHash</a> -&gt; m $ <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> (blk, undo) <a href="src/Pos.DB.Class.html#dbGetBlund" class="link">Source</a> <a href="#v:dbGetBlund" class="selflink">#</a></p><div class="doc"><p>Convenient wrapper which combines <code><a href="Pos-DB-Class.html#v:dbGetBlock">dbGetBlock</a></code> and <code><a href="Pos-DB-Class.html#v:dbGetUndo">dbGetUndo</a></code> to
 read <code>Blund</code>.</p></div></div><div class="top"><p class="src"><span class="keyword">class</span> <a href="Pos-DB-Class.html#t:MonadBlockDBGeneric">MonadBlockDBGeneric</a> header blk undo m =&gt; <a id="t:MonadBlockDBGenericWrite" class="def">MonadBlockDBGenericWrite</a> header blk undo m <span class="keyword">where</span> <a href="src/Pos.DB.Class.html#MonadBlockDBGenericWrite" class="link">Source</a> <a href="#t:MonadBlockDBGenericWrite" class="selflink">#</a></p><div class="doc"><p>Superclass of <code>MonadBlockDB</code> which allows to modify the Block
 DB.</p><p>TODO: support deletion when we actually start using deletion
 (probably not soon).</p></div><div class="subs minimal"><p class="caption">Minimal complete definition</p><p class="src"><a href="Pos-DB-Class.html#v:dbPutBlund">dbPutBlund</a></p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:dbPutBlund" class="def">dbPutBlund</a> :: (blk, undo) -&gt; m () <a href="src/Pos.DB.Class.html#dbPutBlund" class="link">Source</a> <a href="#v:dbPutBlund" class="selflink">#</a></p><div class="doc"><p>Put given blund into the Block DB.</p></div></div><div class="subs instances"><p id="control.i:MonadBlockDBGenericWrite" class="caption collapser" onclick="toggleSection('i:MonadBlockDBGenericWrite')">Instances</p><div id="section.i:MonadBlockDBGenericWrite" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:MonadBlockDBGenericWrite:MonadBlockDBGenericWrite:1" class="instance expander" onclick="toggleSection('i:ic:MonadBlockDBGenericWrite:MonadBlockDBGenericWrite:1')"></span> (<a href="Pos-DB-Class.html#t:MonadBlockDBGenericWrite">MonadBlockDBGenericWrite</a> header blk undo m, <a href="Pos-DB-Class.html#t:MonadBlockDBGeneric">MonadBlockDBGeneric</a> header blk undo (t m), MonadTrans t) =&gt; <a href="Pos-DB-Class.html#t:MonadBlockDBGenericWrite">MonadBlockDBGenericWrite</a> header blk undo (t m)</span> <a href="src/Pos.DB.Class.html#line-239" class="link">Source</a> <a href="#t:MonadBlockDBGenericWrite" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:ic:MonadBlockDBGenericWrite:MonadBlockDBGenericWrite:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:dbPutBlund">dbPutBlund</a> :: (blk, undo) -&gt; t m () <a href="src/Pos.DB.Class.html#dbPutBlund" class="link">Source</a> <a href="#v:dbPutBlund" class="selflink">#</a></p></div></div></td></tr></table></div></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.3</p></div></body></html>